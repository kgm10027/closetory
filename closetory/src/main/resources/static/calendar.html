<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Closetory - ì£¼ê°„ ì½”ë”” ìº˜ë¦°ë”</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fb;
            color: #111827;
        }

        /* ===== ìƒë‹¨ ê³ ì • í—¤ë” ===== */
        .clo-topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 72px;
            background: #ffffff;
            box-shadow: 0 6px 20px rgba(15,23,42,0.06);
            z-index: 50;
        }
        .clo-top-inner {
            max-width: 1180px;
            margin: 0 auto;
            height: 100%;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .clo-top-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .clo-hamburger {
            width: 36px;
            height: 36px;
            border-radius: 999px;
            border: none;
            background: #111827;
            color: #f9fafb;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .clo-logo-main a {
            text-decoration: none;
            color: inherit;
        }
        .clo-logo-main {
            font-size: 22px;
            font-weight: 900;
            letter-spacing: -0.4px;
            cursor: pointer;
        }
        .clo-logo-sub {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 2px;
        }
        .clo-top-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .clo-search-form {
            display: flex;
            align-items: center;
            background: #f3f4f6;
            border-radius: 999px;
            padding: 6px 12px;
            min-width: 260px;
        }
        .clo-search-icon {
            font-size: 14px;
            color: #6b7280;
            margin-right: 6px;
        }
        .clo-search-input {
            border: none;
            background: transparent;
            outline: none;
            font-size: 13px;
            width: 100%;
        }
        .clo-top-btn {
            height: 36px;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background: #ffffff;
            padding: 0 14px;
            font-size: 12px;
            cursor: pointer;
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }
        .clo-top-btn.primary {
            background: #111827;
            color: #f9fafb;
            border-color: #111827;
            font-weight: 600;
        }
        .clo-top-btn:hover {
            background: #f3f4f6;
        }
        .clo-top-btn.primary:hover {
            background: #020617;
        }
        .clo-user-status {
            font-size: 12px;
            color: #6b7280;
            margin-right: 4px;
        }

        /* ===== ì‚¬ì´ë“œë°” ===== */
        .clo-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 230px;
            background: #111827;
            color: #e5e7eb;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            transform: translateX(-100%);
            transition: transform .25s ease-out;
            z-index: 60;
        }
        body.clo-sidebar-open .clo-sidebar {
            transform: translateX(0);
        }
        .clo-sidebar-header {
            font-size: 18px;
            font-weight: 800;
        }
        .clo-sidebar-sub {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 2px;
        }
        .clo-menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 14px;
        }
        .clo-menu-list li {
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background .2s, color .2s;
        }
        .clo-menu-list li:hover {
            background: #1f2937;
            color: #f9fafb;
        }
        .clo-menu-list li.clo-active {
            background: #fbbf24;
            color: #111827;
            font-weight: 700;
        }
        .clo-sidebar-footer {
            margin-top: auto;
            font-size: 11px;
            color: #6b7280;
        }
        .clo-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.35);
            opacity: 0;
            pointer-events: none;
            transition: opacity .2s ease-out;
            z-index: 55;
        }
        body.clo-sidebar-open .clo-backdrop {
            opacity: 1;
            pointer-events: auto;
        }

        /* ===== ë©”ì¸ ì»¨í…ì¸  ===== */
        .clo-main-outer {
            padding-top: 96px;
        }
        .clo-main-wrap {
            max-width: 1180px;
            margin: 0 auto;
            padding: 0 24px 40px;
        }

        /* íƒ€ì´í‹€ */
        .calendar-header h1 {
            margin: 0;
            font-size: 32px;
            font-weight: 900;
        }
        .calendar-header p {
            margin: 6px 0 0;
            font-size: 14px;
            color: #6b7280;
        }

        /* ì¹´í…Œê³ ë¦¬ íƒ­ */
        .category-tabs {
            margin-top: 16px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .category-tab {
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background: #f3f4f6;
            padding: 6px 14px;
            font-size: 13px;
            cursor: pointer;
            color: #4b5563;
        }
        .category-tab.active {
            background: #fff;
            color: #111827;
            border-color: #111827;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(15,23,42,0.06);
        }

        /* ===== ìë™ ë°°ì¹˜ ë²„íŠ¼ ===== */
        .auto-fill-btn {
            width: 100%;
            max-width: 1180px;
            margin: 0 auto 20px;
            display: block;
            padding: 12px 18px;
            font-size: 14px;
            font-weight: 700;
            border-radius: 999px;
            background: #111827;
            color: #f9fafb;
            border: none;
            cursor: pointer;
            text-align: center;
        }
        .auto-fill-btn:hover {
            background: #020617;
        }

        /* ===== ì£¼ê°„ ìŠ¬ë¼ì´ë” ===== */
        .calendar-slider {
            position: relative;
            margin-top: 12px;
        }
        .week-viewport {
            overflow: hidden;
        }
        .week-track {
            display: flex;
            gap: 18px;
            transition: transform .35s ease;
        }

        /* ìš”ì¼ ì¹´ë“œ */
        .day-card {
            flex: 0 0 calc((100% - 2 * 18px) / 3);
            background: #ffffff;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 10px 24px rgba(15,23,42,0.06);
            display: flex;
            flex-direction: column;
            gap: 10px;
            cursor: pointer;
            position: relative;
        }

        /* ì˜¤ëŠ˜ ê°•ì¡° */
        .day-card.today {
            border: 2px solid #facc15;
            box-shadow: 0 0 0 3px rgba(250,204,21,0.3);
        }
        .day-today-badge {
            position: absolute;
            top: -10px;
            left: -10px;
            background: #facc15;
            color: #111;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 999px;
        }

        .day-title {
            font-size: 15px;
            font-weight: 700;
        }

        /* ì „ì‹  ì´ë¯¸ì§€ ëŒ€ì‘ í™•ëŒ€ ë°•ìŠ¤ */
        .day-img {
            width: 100%;
            height: 240px;
            background: #eef0f4;
            border-radius: 14px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .day-desc {
            font-size: 13px;
            color: #6b7280;
        }

        .heart-btn {
            font-size: 16px;
            cursor: pointer;
            color: #9ca3af;
            align-self: flex-end;
        }
        .heart-btn.active {
            color: #ef4444;
        }

        /* ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ */
        .week-slide-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            border-radius: 999px;
            border: none;
            background: rgba(15,23,42,0.7);
            color: #fff;
            cursor: pointer;
            font-size: 18px;
        }
        .week-slide-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 36px;
    height: 36px;
    border-radius: 999px;
    border: none;
    background: rgba(15,23,42,0.75);  /* ì‚´ì§ íˆ¬ëª… */
    color: #f9fafb;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    z-index: 10;
    backdrop-filter: blur(4px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.week-slide-btn.prev {
    left: -16px;        /* â˜… ìœ„ì¹˜ ë³´ì • */
}

.week-slide-btn.next {
    right: -16px;       /* ë™ì¼ ì²˜ë¦¬ */
}

.week-slide-btn:hover {
    background: rgba(15,23,42,0.90);
}
        .week-slide-btn:disabled {
            opacity: 0.3;
            cursor: default;
        }

        /* ===== ìƒì„¸ ëª¨ë‹¬ ===== */
        .cal-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        .cal-modal-backdrop.show {
            display: flex;
        }

        .cal-modal {
            background: #fff;
            width: 520px;
            max-width: 92vw;
            max-height: 90vh;
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px rgba(0,0,0,0.22);
        }

        .cal-modal-header {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cal-modal-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 800;
        }
        .cal-modal-close {
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: #9ca3af;
        }

        .cal-modal-image {
            width: 100%;
            height: 340px;
            background:#eef0f4;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cal-modal-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .cal-modal-body {
            padding: 16px 20px 22px;
            font-size: 14px;
            color: #4b5563;
            overflow-y: auto;
        }
        .cal-modal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }
        .cal-tag {
            background:#e8efff;
            padding:4px 10px;
            font-size:11px;
            border-radius:999px;
            color:#374151;
        }
        .cal-modal-like-btn {
            width:100%;
            margin-top:18px;
            padding:10px;
            border:none;
            border-radius:999px;
            background:#111827;
            color:white;
            cursor:pointer;
            font-weight:600;
        }
        .cal-modal-like-btn.fav {
            background:#b91c1c;
        }

        /* ë¶„ì„ ë°•ìŠ¤ */
        .week-analysis {
            margin-top: 36px;
            padding: 20px 22px;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(15,23,42,0.05);
        }
        .week-analysis h3 {
            margin: 0 0 8px;
            font-size: 18px;
            font-weight: 800;
        }
        .week-analysis p {
            font-size: 13px;
            color: #6b7280;
            margin: 0;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 960px) {
            .day-card { flex: 0 0 80%; }
            .week-slide-btn.prev { left: 4px; }
            .week-slide-btn.next { right: 4px; }
        }
    </style>
</head>
<body>

<!-- ì‚¬ì´ë“œë°” -->
<nav class="clo-sidebar">
    <div>
        <div class="clo-sidebar-header">ë©”ë‰´</div>
        <div class="clo-sidebar-sub">Closetory ì˜·ì¥ ë©”ë‰´</div>
    </div>
    <ul class="clo-menu-list">
        <li onclick="location.href='closet.html'">ë‚˜ë§Œì˜ ì˜·ì¥</li>
        <li onclick="location.href='color.html'">ì½”ë”” ìƒ‰ê° ì¶”ì²œ</li>
        <li onclick="location.href='situation.html'">ìƒí™©ë³„ ì½”ë”” ì¶”ì²œ</li>
        <li class="clo-active" onclick="location.href='calendar.html'">ì£¼ê°„ ì½”ë”” ìº˜ë¦°ë”</li>
        <li onclick="location.href='ranking.html'">ì¸ê¸° ì½”ë”” ë­í‚¹</li>
    </ul>
    <div class="clo-sidebar-footer">
        Closetory Â· ì˜·ì¥ì—ì„œ êº¼ë‚´ëŠ” ì‘ì€ í–‰ë³µ
    </div>
</nav>
<div class="clo-backdrop"></div>

<!-- ìƒë‹¨ë°” -->
<header class="clo-topbar">
    <div class="clo-top-inner">
        <div class="clo-top-left">
            <button class="clo-hamburger" id="cloMenuBtn">â˜°</button>
            <div>
                <div class="clo-logo-main">
                    <a href="index.html">Closetory</a>
                </div>
                <div class="clo-logo-sub">ì˜·ì¥ì—ì„œ êº¼ë‚´ëŠ” ì‘ì€ í–‰ë³µ</div>
            </div>
        </div>

        <div class="clo-top-right">
            <form class="clo-search-form" onsubmit="return false;">
                <span class="clo-search-icon">ğŸ”</span>
                <input class="clo-search-input" type="text" placeholder="ì½”ë””, ì•„ì´í…œ ê²€ìƒ‰">
            </form>

            <span class="clo-user-status" id="userStatus"></span>
            <button class="clo-top-btn" id="loginBtn">ë¡œê·¸ì¸</button>
            <button class="clo-top-btn" id="signupBtn">íšŒì›ê°€ì…</button>
            <button class="clo-top-btn primary" id="mypageBtn" style="display:none;">ë§ˆì´í˜ì´ì§€</button>
            <button class="clo-top-btn" id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>
</header>

<!-- ë©”ì¸ -->
<div class="clo-main-outer">
    <main class="clo-main-wrap">

        <!-- ì œëª© -->
        <section class="calendar-header">
            <h1>ì£¼ê°„ ì½”ë”” ìº˜ë¦°ë”</h1>
            <p>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì„œ ì˜¤ëŠ˜ì„ ê¸°ì¤€ìœ¼ë¡œ 1ì£¼ì¼ ì½”ë””ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>

            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
            <div class="category-tabs" id="categoryTabs">
                <button class="category-tab active" data-category="daily">ë°ì¼ë¦¬</button>
                <button class="category-tab" data-category="date">ë°ì´íŠ¸</button>
                <button class="category-tab" data-category="campus">ìº í¼ìŠ¤</button>
                <button class="category-tab" data-category="travel">ì—¬í–‰</button>
            </div>
        </section>

        <!-- ì£¼ê°„ ìŠ¬ë¼ì´ë” -->
        <section class="calendar-slider">
            <button class="week-slide-btn prev" id="weekPrevBtn">â€¹</button>

            <div class="week-viewport">
                <div class="week-track" id="weekTrack">

                    <!-- ì›”ìš”ì¼ -->
                    <article class="day-card" data-day-index="0">
                        <div class="day-title">ì›”ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ì›”ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- í™”ìš”ì¼ -->
                    <article class="day-card" data-day-index="1">
                        <div class="day-title">í™”ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">í™”ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ìˆ˜ìš”ì¼ -->
                    <article class="day-card" data-day-index="2">
                        <div class="day-title">ìˆ˜ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ìˆ˜ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ëª©ìš”ì¼ -->
                    <article class="day-card" data-day-index="3">
                        <div class="day-title">ëª©ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ëª©ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ê¸ˆìš”ì¼ -->
                    <article class="day-card" data-day-index="4">
                        <div class="day-title">ê¸ˆìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ê¸ˆìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- í† ìš”ì¼ -->
                    <article class="day-card" data-day-index="5">
                        <div class="day-title">í† ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">í† ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ì¼ìš”ì¼ -->
                    <article class="day-card" data-day-index="6">
                        <div class="day-title">ì¼ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ì¼ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                </div>
            </div>

            <button class="week-slide-btn next" id="weekNextBtn">â€º</button>
        </section>

        <!-- ì´ë²ˆ ì£¼ ìŠ¤íƒ€ì¼ ë¶„ì„ -->
        <section class="week-style-analysis" style="
    margin-top: 34px;
    background:#ffffff;
    box-shadow:0 10px 24px rgba(15,23,42,0.06);
    border-radius:16px;
    padding:22px 24px;
">
            <h2 style="margin:0; font-size:20px; font-weight:800;">ì´ë²ˆ ì£¼ ìŠ¤íƒ€ì¼ ë¶„ì„</h2>
            <p id="weekStyleText" style="margin-top:8px; font-size:14px; color:#6b7280;">
                ì´ë²ˆ ì£¼ ì½”ë”” ë¶„ì„ ì¤‘...
            </p>
        </section>
    </main>
</div>

<!-- ìƒì„¸ ëª¨ë‹¬ -->
<div class="cal-modal-backdrop" id="calModalBackdrop">
    <div class="cal-modal" id="calModal">
        <div class="cal-modal-header">
            <h2 id="calModalTitle">ì½”ë”” ì œëª©</h2>
            <button class="cal-modal-close" id="calModalClose">Ã—</button>
        </div>

        <div class="cal-modal-image">
            <img id="calModalImg" src="" alt="">
        </div>

        <div class="cal-modal-body">
            <div class="cal-modal-tags" id="calModalTags"></div>
            <p id="calModalDesc"></p>

            <button id="calModalLikeBtn" class="cal-modal-like-btn">â™¡ ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ê¸°</button>
        </div>
    </div>
</div>
<script>
    /* ===== ì‚¬ì´ë“œë°” í† ê¸€ + ê²€ì€ ë°°ê²½ í´ë¦­ ì‹œ ë‹«í˜ ===== */
    const bodyEl  = document.body;
    const menuBtn = document.getElementById('cloMenuBtn');
    const backdrop = document.querySelector('.clo-backdrop');

    function toggleSidebar() {
        bodyEl.classList.toggle('clo-sidebar-open');
    }
    if (menuBtn)  menuBtn.addEventListener('click', toggleSidebar);
    if (backdrop) backdrop.addEventListener('click', () => {
        bodyEl.classList.remove('clo-sidebar-open');
    });

    /* ===== ë¡œê·¸ì¸ ìƒíƒœ ì²˜ë¦¬ ===== */
    const loginBtn   = document.getElementById('loginBtn');
    const signupBtn  = document.getElementById('signupBtn');
    const logoutBtn  = document.getElementById('logoutBtn');
    const mypageBtn  = document.getElementById('mypageBtn');
    const userStatus = document.getElementById('userStatus');

    function checkAuthState() {
        const raw = localStorage.getItem('closetoryUser');
        if (raw) {
            const user = JSON.parse(raw);
            userStatus.textContent = (user.name || 'ì‚¬ìš©ì') + ' ë‹˜ ë¡œê·¸ì¸ ì¤‘';
            loginBtn.style.display   = 'none';
            signupBtn.style.display  = 'none';
            mypageBtn.style.display  = 'inline-flex';
            logoutBtn.style.display  = 'inline-flex';
        } else {
            userStatus.textContent = '';
            loginBtn.style.display   = 'inline-flex';
            signupBtn.style.display  = 'inline-flex';
            mypageBtn.style.display  = 'none';
            logoutBtn.style.display  = 'none';
        }
    }
    checkAuthState();

    if (loginBtn)  loginBtn.addEventListener('click', () => location.href = 'login.html');
    if (signupBtn) signupBtn.addEventListener('click', () => location.href = 'signup.html');
    if (mypageBtn) mypageBtn.addEventListener('click', () => location.href = 'mypage.html');
    if (logoutBtn) logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('closetoryUser');
        checkAuthState();
        alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.href = 'index.html';
    });

    /* ==========================================================
       1) ì°œ ë°ì´í„° (closet.html / ranking.html ì™„ì „ ë™ì¼ êµ¬ì¡°)
    ========================================================== */
    const FAVORITES_KEY = 'closetoryFavorites';

    function loadFavorites() {
        try {
            return JSON.parse(localStorage.getItem(FAVORITES_KEY) || '[]');
        } catch (_) {
            return [];
        }
    }

    function saveFavorites(list) {
        localStorage.setItem(FAVORITES_KEY, JSON.stringify(list));
    }

    function isFavorite(id) {
        return loadFavorites().some(it => String(it.id) === String(id));
    }

    /* ==========================================================
       2) ìƒì„¸ëª¨ë‹¬ ì—°ë™ (closet.html ë™ì¼ ëª¨ë‹¬ êµ¬ì¡°)
    ========================================================== */
    const calModalBackdrop = document.getElementById('calModalBackdrop');
    const calModal         = document.getElementById('calModal');
    const calModalClose    = document.getElementById('calModalClose');
    const calModalImg      = document.getElementById('calModalImg');
    const calModalTitle    = document.getElementById('calModalTitle');
    const calModalTags     = document.getElementById('calModalTags');
    const calModalDesc     = document.getElementById('calModalDesc');
    const calModalLikeBtn  = document.getElementById('calModalLikeBtn');

    let currentModalItem = null;

    function openCalModal(item) {
        currentModalItem = item;

        calModalTitle.textContent = item.title || "ì½”ë”” ì •ë³´";
        calModalImg.src = item.imageUrl || "";
        calModalImg.alt = item.title || "";

        calModalTags.innerHTML = "";
        (item.tags || []).forEach(t => {
            const span = document.createElement('span');
            span.className = "rank-tag";
            span.textContent = t;
            calModalTags.appendChild(span);
        });

        calModalDesc.textContent = item.desc || "ì½”ë”” ì„¤ëª…ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.";

        // ì°œ ë²„íŠ¼ ìƒíƒœ
        if (isFavorite(item.id)) {
            calModalLikeBtn.textContent = "â¤ ì°œ í•´ì œ";
        } else {
            calModalLikeBtn.textContent = "â™¡ ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ê¸°";
        }

        calModalBackdrop.classList.add("show");
    }

    calModalClose.addEventListener('click', () => {
        calModalBackdrop.classList.remove('show');
    });
    calModalBackdrop.addEventListener('click', e => {
        if (e.target === calModalBackdrop) {
            calModalBackdrop.classList.remove('show');
        }
    });

    /* ===== ìƒì„¸ ëª¨ë‹¬ ì°œê¸°ëŠ¥ ===== */
    calModalLikeBtn.addEventListener('click', () => {
        if (!currentModalItem) return;

        const favs = loadFavorites();
        const exist = favs.find(f => f.id === currentModalItem.id);

        if (exist) {
            // í•´ì œ
            const newList = favs.filter(f => f.id !== currentModalItem.id);
            saveFavorites(newList);
            calModalLikeBtn.textContent = "â™¡ ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ê¸°";
            alert("ì°œ í•´ì œí–ˆìŠµë‹ˆë‹¤.");
        } else {
            favs.push({
                ...currentModalItem,
                isFavorite: true,
                createdAt: Date.now()
            });
            saveFavorites(favs);
            calModalLikeBtn.textContent = "â¤ ì°œ í•´ì œ";
            alert("ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ì•˜ìŠµë‹ˆë‹¤!");
        }
    });
/* ==========================================================
   3) ì£¼ê°„ ì´ë¯¸ì§€ ì„¤ì • (ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ìë™ ë³€ê²½)
========================================================== */

const CATEGORY_IMAGE_PATHS = {
    daily: [
        'images/daily_mon.jpg',
        'images/daily_tue.jpg',
        'images/daily_wed.jpg',
        'images/daily_thu.jpg',
        'images/daily_fri.jpg',
        'images/daily_sat.jpg',
        'images/daily_sun.jpg'
    ],
    date: [
        'images/date_mon.jpg',
        'images/date_tue.jpg',
        'images/date_wed.jpg',
        'images/date_thu.jpg',
        'images/date_fri.jpg',
        'images/date_sat.jpg',
        'images/date_sun.jpg'
    ],
    campus: [
        'images/campus_mon.jpg',
        'images/campus_tue.jpg',
        'images/campus_wed.jpg',
        'images/campus_thu.jpg',
        'images/campus_fri.jpg',
        'images/campus_sat.jpg',
        'images/campus_sun.jpg'
    ],
    travel: [
        'images/travel_mon.jpg',
        'images/travel_tue.jpg',
        'images/travel_wed.jpg',
        'images/travel_thu.jpg',
        'images/travel_fri.jpg',
        'images/travel_sat.jpg',
        'images/travel_sun.jpg'
    ]
};

const weekdayLabels = ['ì›”ìš”ì¼','í™”ìš”ì¼','ìˆ˜ìš”ì¼','ëª©ìš”ì¼','ê¸ˆìš”ì¼','í† ìš”ì¼','ì¼ìš”ì¼'];
let activeCategory = 'daily';
const categoryTabs = document.querySelectorAll('.category-tab');

function applyCategory(categoryKey) {
    activeCategory = categoryKey;

    const imageList = CATEGORY_IMAGE_PATHS[categoryKey] || [];
    const activeTabEl = document.querySelector(`.category-tab[data-category="${categoryKey}"]`);
    const categoryName = activeTabEl ? activeTabEl.textContent.trim() : '';

    // í•˜ë£¨ ì¹´ë“œ ì „ì²´ì— ì´ë¯¸ì§€ ë°˜ì˜ + ì„¤ëª… ë°˜ì˜
    document.querySelectorAll('.day-card').forEach(card => {
        const dayIdx = Number(card.dataset.dayIndex);
        const imgEl = card.querySelector('.day-img');
        const descEl = card.querySelector('.day-desc');
        const path = imageList[dayIdx] || '';

        if (path) {
            imgEl.style.backgroundImage = `url('${path}')`;
        } else {
            imgEl.style.backgroundImage = 'none';
        }

        const weekdayName = weekdayLabels[dayIdx];
        descEl.textContent = `${categoryName} Â· ${weekdayName} ì½”ë””`;
    });
}

categoryTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const category = tab.dataset.category;
        categoryTabs.forEach(t => t.classList.toggle('active', t === tab));
        resetToTodayWindow();
        applyCategory(category);
    });
});

/* ==========================================================
   4) ìŠ¬ë¼ì´ë” â€” 3ê°œì”© ë³´ì´ê²Œ / ì˜¤ëŠ˜ì´ ë§¨ ì•
========================================================== */

const weekTrack = document.getElementById('weekTrack');
const weekPrevBtn = document.getElementById('weekPrevBtn');
const weekNextBtn = document.getElementById('weekNextBtn');

let dayCards = Array.from(weekTrack.children);
const VISIBLE_COUNT = 3;
const GAP = 18;
let slideIndex = 0;
let cardStep = 0;
let maxIndex = Math.max(0, dayCards.length - VISIBLE_COUNT);

// JS getDay(): 0=ì¼ ~ 6=í† 
function getMondayBasedIndex(jsDay) {
    return (jsDay + 6) % 7; // ì›”=0 ~ ì¼=6
}

// ì˜¤ëŠ˜ì´ ì²« ì¹´ë“œê°€ ë˜ë„ë¡ ì£¼ê°„ ë°°ì—´ ì¬ë°°ì¹˜
function sortDaysByToday() {
    const today = new Date();
    const jsDay = today.getDay();       // 0~6
    const mondayBasedToday = getMondayBasedIndex(jsDay);

    dayCards = Array.from(weekTrack.children);

    const sorted = dayCards.slice().sort((a, b) => {
        const aIdx = Number(a.dataset.dayIndex);
        const bIdx = Number(b.dataset.dayIndex);
        const aOff = (aIdx - mondayBasedToday + 7) % 7;
        const bOff = (bIdx - mondayBasedToday + 7) % 7;
        return aOff - bOff;
    });

    sorted.forEach(c => weekTrack.appendChild(c));
    dayCards = sorted;
    slideIndex = 0;
    updateMetrics();
}

function recalcMaxIndex() {
    maxIndex = Math.max(0, dayCards.length - VISIBLE_COUNT);
}

function updateNavButtons() {
    recalcMaxIndex();
    weekPrevBtn.disabled = (slideIndex <= 0);
    weekNextBtn.disabled = (slideIndex >= maxIndex);
}

function updateMetrics() {
    if (!dayCards.length) return;
    const first = dayCards[0];
    const rect = first.getBoundingClientRect();
    cardStep = rect.width + GAP;

    weekTrack.style.transition = 'none';
    weekTrack.style.transform = `translateX(-${slideIndex * cardStep}px)`;

    requestAnimationFrame(() => {
        weekTrack.style.transition = 'transform .35s ease';
    });

    updateNavButtons();
}

function goToSlide(idx) {
    recalcMaxIndex();
    slideIndex = Math.min(Math.max(idx, 0), maxIndex);
    weekTrack.style.transform = `translateX(-${slideIndex * cardStep}px)`;
    updateNavButtons();
}

function resetToTodayWindow() {
    goToSlide(0);
}

weekPrevBtn.addEventListener('click', () => goToSlide(slideIndex - 1));
weekNextBtn.addEventListener('click', () => goToSlide(slideIndex + 1));

/* ==========================================================
   5) â€œí•˜ë£¨ ì¹´ë“œ í´ë¦­ â†’ ìƒì„¸ ëª¨ë‹¬ ë„ìš°ê¸°â€
========================================================== */

document.querySelectorAll('.day-card').forEach(card => {
    card.addEventListener('click', () => {
        const day = Number(card.dataset.dayIndex);
        const image = CATEGORY_IMAGE_PATHS[activeCategory][day] || '';
        const weekday = weekdayLabels[day];
        const categoryTitle = document.querySelector('.category-tab.active').textContent.trim();

        const item = {
            id: `${activeCategory}-${day}`,
            title: `${weekday} (${categoryTitle}) ì½”ë””`,
            desc: `${categoryTitle} Â· ${weekday} ì½”ë””ì…ë‹ˆë‹¤.`,
            tags: [categoryTitle, weekday],
            imageUrl: image
        };

        openCalModal(item);
    });
});

/* ==========================================================
   ì´ˆê¸° ì‹¤í–‰
========================================================== */

window.addEventListener('load', () => {
    sortDaysByToday();
    applyCategory(activeCategory);
    analyzeWeekStyle();   // â˜… ìŠ¤íƒ€ì¼ ë¶„ì„ ì‹¤í–‰!
});
window.addEventListener('resize', updateMetrics);

    /* ==========================================================
   6) ì´ë²ˆ ì£¼ ìŠ¤íƒ€ì¼ ë¶„ì„ ìë™ ìƒì„±
========================================================== */
function analyzeWeekStyle() {
    const images = CATEGORY_IMAGE_PATHS[activeCategory];
    const categoryName = document.querySelector('.category-tab.active').textContent.trim();

    // ë¹ˆ ì´ë¯¸ì§€ ì œì™¸
    const usedImages = images.filter(src => src && src !== "");

    // íƒœê·¸ ê¸°ë°˜ ê°„ë‹¨ ë¶„ì„
    let styleKeywords = [];

    if (activeCategory === "daily") styleKeywords = ["ìºì£¼ì–¼", "ë°ì¼ë¦¬", "ê¸°ë³¸í…œ"];
    if (activeCategory === "date") styleKeywords = ["í¬ê·¼í•¨", "ë°ì´íŠ¸ë£©", "ì„¸ë¯¸í¬ë©€"];
    if (activeCategory === "campus") styleKeywords = ["í¸ì•ˆí•¨", "ìº í¼ìŠ¤ë£©", "ë§¨íˆ¬ë§¨", "ë°ë‹˜"];
    if (activeCategory === "travel") styleKeywords = ["í™œë™ì„±", "ì—¬í–‰ë£©", "ê°€ë²¼ì›€"];

    // ì´ë²ˆ ì£¼ í†¤ ë¶„ì„
    let toneText = "";
    if (activeCategory === "daily") toneText = "ì°¨ë¶„í•˜ê³  ê¸°ë³¸ì— ì¶©ì‹¤í•œ ì½”ë””ê°€ ì¤‘ì‹¬ì´ì—ˆì–´ìš”.";
    if (activeCategory === "date") toneText = "ë”°ëœ»í•˜ê³  ê°ì„±ì ì¸ ë°ì´íŠ¸ ì½”ë””ê°€ ë§ì•˜ì–´ìš”.";
    if (activeCategory === "campus") toneText = "ìºì£¼ì–¼í•˜ê³  í™œë™ì ì¸ ìŠ¤íƒ€ì¼ì´ ë‘ë“œëŸ¬ì¡Œì–´ìš”.";
    if (activeCategory === "travel") toneText = "ì‹¤ìš©ì ì´ë©´ì„œ í™œë™ì ì¸ ì—¬í–‰ ìŠ¤íƒ€ì¼ì´ ê°•í–ˆì–´ìš”.";

    // ìµœì¢… ë¬¸ì¥ ì¡°ë¦½
    const result =
        `ì´ë²ˆ ì£¼ëŠ” '${categoryName}' ìŠ¤íƒ€ì¼ì„ ì¤‘ì‹¬ìœ¼ë¡œ
        ${toneText}
        ì£¼ìš” í‚¤ì›Œë“œëŠ” ${styleKeywords.slice(0, 3).join(", ")} ì…ë‹ˆë‹¤.`;

    document.getElementById("weekStyleText").textContent = result;
}
</script>
