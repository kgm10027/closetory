<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ì½”ë”” ìƒ‰ê° ì¶”ì²œ - Closetory</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        /* ============ ê³µí†µ (closet ìŠ¤íƒ€ì¼ ê¸°ì¤€) ============ */
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fb;
            color: #111827;
        }

        /* ìƒë‹¨ ë°” */
        .clo-topbar {
            position: fixed; top: 0; left: 0; right: 0;
            height: 72px; background: #fff;
            box-shadow: 0 6px 20px rgba(15,23,42,0.06);
            z-index: 50;
        }
        .clo-top-inner {
            max-width: 1180px; margin: 0 auto; height: 100%;
            padding: 0 24px; display:flex; align-items:center; justify-content:space-between;
        }
        .clo-top-left { display:flex; align-items:center; gap:14px; }
        .clo-hamburger {
            width:36px; height:36px; border-radius:999px; border:none;
            background:#111827; color:#f9fafb; font-size:18px; cursor:pointer;
            display:flex; align-items:center; justify-content:center;
        }
        .clo-logo-main { font-size:22px; font-weight:900; }
        .clo-logo-sub { font-size:11px; color:#9ca3af; margin-top:2px; }

        .clo-top-right { display:flex; align-items:center; gap:10px; }
        .clo-search-form { display:flex; align-items:center; background:#f3f4f6; border-radius:999px; padding:6px 12px; min-width:260px; }
        .clo-search-input { border:none; background:transparent; outline:none; font-size:13px; width:100%; }
        .clo-top-btn { height:36px; border-radius:999px; border:1px solid #e5e7eb; background:#fff; padding:0 14px; font-size:12px; cursor:pointer; color:#374151; display:flex; align-items:center; }
        .clo-top-btn.primary { background:#111827; color:#fff; border-color:#111827; font-weight:600; }

        /* ì‚¬ì´ë“œë°” */
        .clo-sidebar {
            position:fixed; top:0; left:0; bottom:0; width:230px;
            background:#111827; color:#e5e7eb; padding:24px 20px;
            display:flex; flex-direction:column; gap:24px;
            transform:translateX(-100%); transition:transform .25s ease-out; z-index:60;
        }
        body.clo-sidebar-open .clo-sidebar { transform:translateX(0); }
        .clo-sidebar-header { font-size:18px; font-weight:800; }
        .clo-sidebar-sub { font-size:12px; color:#9ca3af; margin-top:2px; }
        .clo-menu-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px; font-size:14px; }
        .clo-menu-list li { padding:8px 10px; border-radius:8px; cursor:pointer; transition:background .2s, color .2s; }
        .clo-menu-list li:hover { background:#1f2937; color:#fff; }
        .clo-menu-list li.clo-active { background:#fbbf24; color:#111827; font-weight:700; }
        .clo-sidebar-footer { margin-top:auto; font-size:11px; color:#6b7280; }

        .clo-backdrop { position:fixed; inset:0; background:rgba(15,23,42,0.35); opacity:0; pointer-events:none; transition:opacity .2s ease-out; z-index:55; }
        body.clo-sidebar-open .clo-backdrop { opacity:1; pointer-events:auto; }

        /* ë©”ì¸ */
        .clo-main-outer { padding-top:96px; }
        .clo-main-wrap { max-width:1180px; margin:0 auto; padding:0 24px 40px; }

        h1 { margin:0 0 18px 0; font-size:32px; font-weight:900; }

        .color-box {
            background:#fff; padding:24px; border-radius:14px; box-shadow:0 8px 24px rgba(15,23,42,0.04);
        }
        .controls { display:flex; align-items:center; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
        .color-select { padding:10px 14px; border-radius:8px; border:1px solid #d1d5db; font-size:14px; }
        .btn-recommend { padding:10px 16px; background:#111827; color:#fff; border:none; border-radius:8px; cursor:pointer; }

        .result-wrap { margin-top:16px; display:grid; gap:14px; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); }
        .color-card { background:#fff; padding:12px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,0.06); text-align:center; cursor:pointer; transition:transform .12s; }
        .color-card:hover { transform:translateY(-6px); }
        .color-preview { width:84px; height:84px; margin:0 auto; border-radius:12px; border:2px solid #e5e7eb; }
        .color-name { margin-top:10px; font-weight:700; color:#111827; }

        /* SVG character (ì‹¤ë£¨ì—£) ì˜ì—­ */
        .character-area { margin-top:22px; display:flex; justify-content:center; align-items:center; }
        svg#previewSvg { width:200px; height:auto; display:block; }
        #svgTop, #svgBottom { transition: fill .18s ease; }

        .selected { outline:3px solid rgba(59,130,246,0.12); box-shadow:0 10px 28px rgba(59,130,246,0.06); }

        @media (max-width:720px) {
            .clo-main-wrap { padding:0 16px 28px; }
            .result-wrap { grid-template-columns:repeat(2, minmax(0,1fr)); }
            svg#previewSvg { width:160px; }
        }

        #colorExplain { display:none; margin-top:16px; background:#fff; padding:14px; border-radius:10px; box-shadow:0 6px 16px rgba(0,0,0,0.06); color:#374151; font-size:14px; }

    </style>
</head>
<body>
<!-- sidebar -->
<nav class="clo-sidebar" aria-hidden="true">
    <div>
        <div class="clo-sidebar-header">ë©”ë‰´</div>
        <div class="clo-sidebar-sub">Closetory ì˜·ì¥ ë©”ë‰´</div>
    </div>

    <ul class="clo-menu-list">
        <li onclick="location.href='closet.html'">ë‚˜ë§Œì˜ ì˜·ì¥</li>
        <li class="clo-active">ì½”ë”” ìƒ‰ê° ì¶”ì²œ</li>
        <li onclick="location.href='situation.html'">ìƒí™©ë³„ ì½”ë”” ì¶”ì²œ</li>
        <li onclick="location.href='calendar.html'">ì£¼ê°„ ì½”ë”” ìº˜ë¦°ë”</li>
        <li onclick="location.href='ranking.html'">ì¸ê¸° ì½”ë”” ë­í‚¹</li>
    </ul>

    <div class="clo-sidebar-footer">Closetory Â· ì˜·ì¥ì—ì„œ êº¼ë‚´ëŠ” ì‘ì€ í–‰ë³µ</div>
</nav>
<div class="clo-backdrop" id="backdrop"></div>

<!-- header -->
<header class="clo-topbar">
    <div class="clo-top-inner">
        <div class="clo-top-left">
            <button class="clo-hamburger" id="cloMenuBtn">â˜°</button>
            <div>
                <a href="index.html" style="text-decoration:none;color:inherit;">
                    <div class="clo-logo-main">Closetory</div>
                    <div class="clo-logo-sub">ì˜·ì¥ì—ì„œ êº¼ë‚´ëŠ” ì‘ì€ í–‰ë³µ</div>
                </a>
            </div>
        </div>

        <div class="clo-top-right">
            <form class="clo-search-form" onsubmit="return false;">
                <span>ğŸ”</span>
                <input class="clo-search-input" type="text" placeholder="ì½”ë””, ì•„ì´í…œ ê²€ìƒ‰" />
            </form>

            <div id="cloAuthLoggedOut">
                <button class="clo-top-btn" onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
                <button class="clo-top-btn" onclick="location.href='signup.html'">íšŒì›ê°€ì…</button>
            </div>

            <div id="cloAuthLoggedIn" style="display:none;align-items:center;gap:8px;">
                <span class="clo-user-label"><strong id="cloUserName"></strong> ë‹˜</span>
                <button class="clo-top-btn" onclick="location.href='mypage.html'">ë§ˆì´í˜ì´ì§€</button>
                <button class="clo-top-btn primary" id="cloLogoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </div>
</header>

<!-- main -->
<div class="clo-main-outer">
    <main class="clo-main-wrap">
        <h1>ì½”ë”” ìƒ‰ê° ì¶”ì²œ</h1>

        <div class="color-box">
            <div class="controls">
                <select id="baseColor" class="color-select">
                    <option value="black">ë¸”ë™</option>
                    <option value="white">í™”ì´íŠ¸</option>
                    <option value="navy">ë„¤ì´ë¹„</option>
                    <option value="gray">ê·¸ë ˆì´</option>
                    <option value="beige">ë² ì´ì§€</option>
                </select>

                <button id="btnRecommend" class="btn-recommend">ì¶”ì²œë°›ê¸°</button>
            </div>

            <div id="result" class="result-wrap" aria-live="polite"></div>
            <!-- ì„¤ëª… í…ìŠ¤íŠ¸ í‘œì‹œ ì˜ì—­: ì¶”ì²œ ìƒ‰ ì¡°í•© ì„¤ëª…ì„ ë³´ì—¬ì¤Œ -->


            <!-- character (ì‚¬ëŒ ì‹¤ë£¨ì—£) -->
            <div class="character-area">
                <svg id="previewSvg" viewBox="0 0 200 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="ìºë¦­í„° ë¯¸ë¦¬ë³´ê¸°">
                    <!-- ë¨¸ë¦¬ (ê³ ì •) -->
                    <circle cx="100" cy="48" r="28" fill="#F7D8B7" />

                    <!-- ê¸´íŒ” ìƒì˜: ê°€ìš´ë° ëª¸í†µ(rect) + ì¢Œìš° ì†Œë§¤(rect) -->
                    <g id="svgTopGroup" transform="">
                        <!-- ëª¸í†µ(ê¸´íŒ” ìƒì˜ì˜ ë©”ì¸ ë¶€ë¶„) -->
                        <rect id="svgTopMain" x="52" y="86" width="96" height="78" rx="18"
                              fill="#D1D5DB" stroke="rgba(0,0,0,0.04)" stroke-width="0.6" />

                        <!-- ì™¼ìª½ ì†Œë§¤ -->
                        <rect id="svgTopLeftSleeve" x="28" y="92" width="36" height="36" rx="12"
                              fill="rgba(0,0,0,0.03)" />

                        <!-- ì˜¤ë¥¸ìª½ ì†Œë§¤ -->
                        <rect id="svgTopRightSleeve" x="136" y="92" width="36" height="36" rx="12"
                              fill="rgba(0,0,0,0.03)" />
                    </g>

                    <!-- í—ˆë¦¬ ìŒì˜ -->
                    <rect x="76" y="160" width="48" height="6" rx="3" fill="rgba(0,0,0,0.03)" />

                    <!-- í•˜ì˜ (ê¸´ ë°”ì§€: ì™¼ìª½ ë‹¤ë¦¬, ì˜¤ë¥¸ìª½ ë‹¤ë¦¬) -->
                    <g id="svgBottomGroup">
                        <!-- ì™¼ìª½ ë‹¤ë¦¬ -->
                        <path id="svgBottomLeft"
                              d="M74 166 L96 166 L96 322 C96 332 90 336 84 336 L74 336 C68 336 62 332 62 322 Z"
                              fill="#E5E7EB" stroke="rgba(0,0,0,0.04)" stroke-width="0.5" />

                        <!-- ì˜¤ë¥¸ìª½ ë‹¤ë¦¬ -->
                        <path id="svgBottomRight"
                              d="M104 166 L126 166 L126 322 C126 332 120 336 114 336 L104 336 C98 336 92 332 92 322 Z"
                              fill="#E5E7EB" stroke="rgba(0,0,0,0.04)" stroke-width="0.5" />
                    </g>

                    <!-- ì‹ ë°œ -->
                    <rect x="78" y="336" rx="6" width="18" height="8" fill="#2b2b2b"/>
                    <rect x="108" y="336" rx="6" width="18" height="8" fill="#2b2b2b"/>
                </svg>
            </div>

        </div> <!-- character-area -->

        <div id="colorExplain" style="display:none; margin-top:16px; background:#fff; padding:14px; border-radius:10px; box-shadow:0 6px 16px rgba(0,0,0,0.06); color:#374151; font-size:14px;">
            <!-- JSê°€ ë‚´ìš©ì„ ì±„ì›ë‹ˆë‹¤ -->
        </div>

        <div id="combo-box" style="
    margin-top: 40px;
    padding: 20px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    width: 70%;
    margin-left: auto;
    margin-right: auto;
    display: none;
">
            <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">ì½”ë”” ì¡°í•© ì„¤ëª…</h3>
            <div id="combo-text" style="font-size: 15px; color: #555;"></div>
        </div>


        <!-- ì½”ë”” ì¡°í•© ê²°ê³¼ ì˜ì—­ -->
        <div id="combo-result" style="margin-top:40px; display:none;">
            <!-- ìƒÂ·í•˜ì˜ ì¡°í•© ì„¤ëª… ë°•ìŠ¤ -->
            <div id="matchInfoBox"
                 style="display:none; margin-top:20px; background:#fff; padding:18px;
            border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06);">

                <h3 style="margin-top:0; margin-bottom:12px; font-size:18px; font-weight:700;">
                    ìƒÂ·í•˜ì˜ ì¡°í•© ì„¤ëª…
                </h3>

                <div id="matchInfoContent" style="font-size:14px; color:#374151; line-height:1.5;">
                    <!-- JSê°€ ë‚´ìš©ì„ ìë™ìœ¼ë¡œ ì±„ì›€ -->
                </div>
            </div>



        </div>
    </main>
</div>

<script>
    /* -------------------- ì‚¬ì´ë“œë°” í† ê¸€ -------------------- */
    const bodyEl = document.body;
    const menuBtn = document.getElementById('cloMenuBtn');
    const backdrop = document.getElementById('backdrop');
    menuBtn.addEventListener('click', () => bodyEl.classList.toggle('clo-sidebar-open'));
    backdrop.addEventListener('click', () => bodyEl.classList.remove('clo-sidebar-open'));



    /* -------------------- ë¡œê·¸ì¸ UI (ê°„ë‹¨ ì¬ì‚¬ìš©) -------------------- */
    function refreshAuthUI() {
        const data = localStorage.getItem('closetoryUser');
        const loggedIn = localStorage.getItem('closetoryLoggedIn') === 'true';
        const user = data ? JSON.parse(data) : null;
        const outBox = document.getElementById('cloAuthLoggedOut');
        const inBox  = document.getElementById('cloAuthLoggedIn');
        const nameSpan = document.getElementById('cloUserName');
        if(!outBox || !inBox) return;
        if(loggedIn && user) {
            outBox.style.display = 'none';
            inBox.style.display = 'flex';
            if(nameSpan) nameSpan.textContent = user.name || user.userId || 'ì‚¬ìš©ì';
        } else {
            outBox.style.display = 'flex';
            inBox.style.display = 'none';
        }
    }
    function setupLogout() {
        const btn = document.getElementById('cloLogoutBtn');
        if(!btn) return;
        btn.addEventListener('click', () => {
            localStorage.setItem('closetoryLoggedIn','false');
            alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
            refreshAuthUI();
        });
    }
    refreshAuthUI();
    setupLogout();

    /* -------------------- ìƒ‰ ë§µ (ì˜ì–´í‚¤ + í•œê¸€í‚¤ë¡œ ë§¤í•‘ ê°€ëŠ¥) -------------------- */
    const COLOR_MAP = {
        black: { hex:'#000000', name:'ë¸”ë™' },
        white: { hex:'#FFFFFF', name:'í™”ì´íŠ¸' },
        navy: { hex:'#1E3A8A', name:'ë„¤ì´ë¹„' },
        gray: { hex:'#9CA3AF', name:'ê·¸ë ˆì´' },
        beige: { hex:'#D6C4A0', name:'ë² ì´ì§€' },
        lime: { hex:'#C7E76F', name:'ë¼ì„' },
        lightblue: { hex:'#ADD8E6', name:'ë¼ì´íŠ¸ ë¸”ë£¨' },
        khaki: { hex:'#6B8E23', name:'ì¹´í‚¤' },
        mint: { hex:'#7FE7C6', name:'ë¯¼íŠ¸' },
        brown: { hex:'#A0522D', name:'ë¸Œë¼ìš´' },
        ë²„ê±´ë””: { hex: '#8B1E2A', name: 'ë²„ê±´ë””' },
        ì˜¬ë¦¬ë¸Œ: { hex: '#556B2F', name: 'ì˜¬ë¦¬ë¸Œ' }
    };
    /* í•œê¸€->key ë§µ (ì„œë²„ê°€ í•œê¸€ë¡œ ì¤„ ê²½ìš° ì²˜ë¦¬) */
    const HANGUL_TO_KEY = {
        'ë¼ì„':'lime', 'ë¼ì´íŠ¸ ë¸”ë£¨':'lightblue',
        'ì¹´í‚¤':'khaki', 'ë¯¼íŠ¸':'mint', 'ë¸Œë¼ìš´':'brown', 'ë„¤ì´ë¹„':'navy',
        'ë¸”ë™':'black', 'í™”ì´íŠ¸':'white', 'ê·¸ë ˆì´':'gray', 'ë² ì´ì§€':'beige'
    };

    /* -------------------- í—¬í¼: ì…ë ¥ê°’(í‚¤/í•œê¸€/hex) -> hex ë°˜í™˜ -------------------- */
    function normalizeToHex(val) {
        if(val === undefined || val === null) return null;
        val = String(val).trim();
        if(val === '') return null;
        // ì´ë¯¸ HEX (#fff / #ffffff)
        if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(val)) return val;
        // ì˜ë¬¸ key
        const key = val.toLowerCase().replace(/\s+/g,'');
        if(COLOR_MAP[key]) return COLOR_MAP[key].hex;
        // í•œê¸€ name
        if(HANGUL_TO_KEY[val]) {
            const k = HANGUL_TO_KEY[val];
            if(COLOR_MAP[k]) return COLOR_MAP[k].hex;
        }
        // ì†Œë¬¸ì ìŠ¤í ë§ ì˜ˆ: 'lightblue' without spaces
        if(COLOR_MAP[val.toLowerCase()]) return COLOR_MAP[val.toLowerCase()].hex;
        // ë§ˆì§€ë§‰ ì‹œë„: ë¸Œë¼ìš°ì € ì»¬ëŸ¬ í‚¤ì›Œë“œ(ì˜ˆ: 'salmon')
        if(/^[a-z\-]+$/i.test(val) && val.length < 20) return val.toLowerCase();
        return null;
    }

    /* -------------------- SVG ìƒ‰ ë°˜ì˜ (ìƒì˜/í•˜ì˜ + í…Œë‘ë¦¬) -------------------- */
function setSvgTopBottom(topVal, bottomVal) {
    const topHex = normalizeToHex(topVal) || '#D1D5DB';
    const botHex = normalizeToHex(bottomVal) || '#E5E7EB';

    // ìƒì˜ íŒŒì¸ 
    const topParts = [
        document.getElementById('svgTopMain'),
        document.getElementById('svgTopLeftSleeve'),
        document.getElementById('svgTopRightSleeve')
    ];

    // í•˜ì˜ íŒŒì¸ 
    const bottomParts = [
        document.getElementById('svgBottomLeft'),
        document.getElementById('svgBottomRight')
    ];

    // ìƒì˜ ì ìš©
    topParts.forEach(el => {
        if (el) {
            el.setAttribute('fill', topHex);
            el.setAttribute('stroke', '#555');       // í…Œë‘ë¦¬ ìƒ‰
            el.setAttribute('stroke-width', '2');    // í…Œë‘ë¦¬ ë‘ê»˜
        }
    });

    // í•˜ì˜ ì ìš©
    bottomParts.forEach(el => {
        if (el) {
            el.setAttribute('fill', botHex);
            el.setAttribute('stroke', '#555');       // í…Œë‘ë¦¬ ìƒ‰
            el.setAttribute('stroke-width', '2');    // ë‘ê»˜
        }
    });
}


/* -------------------------------------
   HEX ìƒ‰ìƒì„ ë°ê¸° ì¡°ì ˆí•˜ëŠ” ìœ í‹¸ í•¨ìˆ˜
   amount: -255~255 (ìŒìˆ˜=ì–´ë‘¡ê²Œ, ì–‘ìˆ˜=ë°ê²Œ)
-------------------------------------- */
function darken(hex, amount = -20) {
    if (!hex) return hex;

    // HEX ë¬¸ìì—´ ì •ê·œí™” (# ì œê±°)
    hex = hex.replace('#', '');

    // 3ìë¦¬ hex(#abc) â†’ 6ìë¦¬(#aabbcc) ë³€í™˜
    if (hex.length === 3) {
        hex = hex.split('').map(c => c + c).join('');
    }

    let r = parseInt(hex.substring(0, 2), 16);
    let g = parseInt(hex.substring(2, 4), 16);
    let b = parseInt(hex.substring(4, 6), 16);

    // ë°ê¸° ì¡°ì ˆ
    r = Math.min(255, Math.max(0, r + amount));
    g = Math.min(255, Math.max(0, g + amount));
    b = Math.min(255, Math.max(0, b + amount));

    // ë‹¤ì‹œ HEXë¡œ ë³€í™˜
    const toHex = (n) => n.toString(16).padStart(2, '0');
    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
}



    /* -------------------- ì¶”ì²œ ë Œë” ë° ìƒí˜¸ì‘ìš© -------------------- */
    let lastBaseColorKey = 'black';
    let selectedCard = null;

    function renderRecommended(list) {
        const wrap = document.getElementById('result');
        wrap.innerHTML = '';
        if(!Array.isArray(list) || list.length === 0) {
            wrap.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#6b7280">ì¶”ì²œ ìƒ‰ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        list.forEach(item => {
            // display name (í•œê¸€/ì˜ë¬¸/hex) ìš°ì„  ì²˜ë¦¬
            const raw = String(item);
            let displayName = raw;
            let key = raw.toLowerCase().replace(/\s+/g,'');

            if(COLOR_MAP[key]) displayName = COLOR_MAP[key].name;
            else if(HANGUL_TO_KEY[raw] && COLOR_MAP[HANGUL_TO_KEY[raw]]) displayName = COLOR_MAP[HANGUL_TO_KEY[raw]].name;
            else if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(raw)) displayName = raw.toUpperCase();

            const hex = normalizeToHex(item) || '#D1D5DB';

            const card = document.createElement('div');
            card.className = 'color-card';
            card.setAttribute('role','button');
            card.setAttribute('tabindex','0');

            const preview = document.createElement('div');
            preview.className = 'color-preview';
            preview.style.background = hex;
            // ê°€ì‹œì„± ë³´ê°•: ë°ì€ ìƒ‰ì´ë©´ ì–‡ì€ í…Œë‘ë¦¬ ì¶”ê°€
            const lum = getLuminance(hex);
            if(lum > 0.78) preview.style.border = '2px solid rgba(0,0,0,0.14)';

            const name = document.createElement('div');
            name.className = 'color-name';
            name.textContent = displayName;

            card.appendChild(preview);
            card.appendChild(name);
            wrap.appendChild(card);

            // í´ë¦­/í‚¤ë³´ë“œ Enter: í•˜ì˜ë§Œ ë³€ê²½
            function activate() {
    // ì„ íƒ ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸
    if (selectedCard) selectedCard.classList.remove('selected');
    card.classList.add('selected');
    selectedCard = card;

    // í•˜ì˜ ìƒ‰ ë³€ê²½
    setSvgTopBottom(lastBaseColorKey, item);

    // ---------------------------
    // ìºë¦­í„° ì•„ë˜ ì„¤ëª… ë°•ìŠ¤ ì—…ë°ì´íŠ¸
    // ---------------------------
    const explainBox = document.getElementById('colorExplain');
    explainBox.style.display = 'block';
    explainBox.innerHTML = '<div style="color:#6b7280;">ì„¤ëª…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

    // API í˜¸ì¶œ
    fetch(`/api/color/explain?color=${encodeURIComponent(item)}`)
        .then(resp => {
            if (!resp.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜');
            return resp.json();
        })
        .then(data => {
            if (!data || !data.matches || data.matches.length === 0) {
                explainBox.innerHTML =
                    '<div style="color:#6b7280;">ì„¤ëª… ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            const first = data.matches[0];  // ê°€ì¥ ì²«ë²ˆì§¸ ì¶”ì²œ ì´ìœ 
            const displayName =
                (COLOR_MAP[item] && COLOR_MAP[item].name) || item;
            const hex = normalizeToHex(item);

            explainBox.innerHTML = `
                <div style="display:flex; gap:12px; align-items:center;">
                    <div style="width:40px; height:40px; border-radius:10px;
                                background:${hex}; border:1px solid rgba(0,0,0,0.08);"></div>
                    <div style="font-size:17px; font-weight:700;">
                        ${displayName}
                    </div>
                </div>
                <div style="margin-top:10px; line-height:1.6;">
                    ${first.reason}
                </div>
            `;
        })
        .catch(err => {
            explainBox.innerHTML =
                '<div style="color:#ef4444;">ì„¤ëª… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
        });
}


            card.addEventListener('click', activate);
            card.addEventListener('keydown', (e) => { if(e.key === 'Enter') activate(); });
        });
    }
// list: ["beige","white","lightblue","khaki"] ë“± (ì„œë²„ì—ì„œ ì˜¨ ê°’)
async function attachExplanationsToCards(list) {
    if (!Array.isArray(list) || list.length === 0) return;
    const explainCalls = list.map(c =>
        fetch(`/api/color/explain?color=${encodeURIComponent(c)}`)
            .then(r => r.ok ? r.json() : null)
            .catch(() => null)
    );

    const explains = await Promise.all(explainCalls);
    const cards = document.querySelectorAll('#result .color-card');

    cards.forEach((card, idx) => {
        // ì¹´ë“œê°€ ì—†ëŠ” ê²½ìš° ìŠ¤í‚µ
        if (!card) return;

        // ê¸°ì¡´ì— ì„¤ëª… ì—˜ë¦¬ë¨¼íŠ¸ê°€ ìˆë‹¤ë©´ ì œê±°


        if (!resp || !resp.matches || resp.matches.length === 0) {
            p.textContent = 'ì„¤ëª… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        } else {
            // ì²«ë²ˆì§¸ ë§¤ì¹­ ì´ìœ  ì‚¬ìš© (ì›í•˜ë©´ ì—¬ëŸ¬ê°œ ë…¸ì¶œ)
            p.textContent = resp.matches[0].reason;
        }
        card.appendChild(p);
    });

}

    /* -------------------- íœ˜ë„ ê³„ì‚° (í…Œë‘ë¦¬/ëŒ€ë¹„ìš©) -------------------- */
    function hexToRgb(hex) {
        if(!hex) return [0,0,0];
        hex = hex.replace('#','');
        if(hex.length === 3) hex = hex.split('').map(c=>c+c).join('');
        const num = parseInt(hex,16);
        return [(num>>16)&255, (num>>8)&255, num&255];
    }
    function getLuminance(hexOrKeyword) {
        try {
            // if keyword, let browser compute via temporary element
            if(!/^#/.test(String(hexOrKeyword))) {
                const temp = document.createElement('div');
                temp.style.color = hexOrKeyword;
                document.body.appendChild(temp);
                const cs = getComputedStyle(temp).color;
                document.body.removeChild(temp);
                const m = cs.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
                if(m) return luminanceFromRgb([+m[1],+m[2],+m[3]]);
                return 0;
            }
            const rgb = hexToRgb(hexOrKeyword);
            return luminanceFromRgb(rgb);
        } catch (e) { return 0; }
    }
    function luminanceFromRgb([r,g,b]) {
        const srgb = [r,g,b].map(v => v/255).map(c => (c <= 0.03928 ? c/12.92 : Math.pow((c+0.055)/1.055, 2.4)));
        return 0.2126*srgb[0] + 0.7152*srgb[1] + 0.0722*srgb[2];
    }

    /* -------------------- ì¶”ì²œ ë²„íŠ¼ í•¸ë“¤ëŸ¬ -------------------- */
    document.getElementById('btnRecommend').addEventListener('click', async () => {
        const base = document.getElementById('baseColor').value;
        lastBaseColorKey = base;

        showMatchInfo(base);   // â† ì—¬ê¸° ì¶”ê°€!

        // 1) ìƒì˜ ì¦‰ì‹œ ë°˜ì˜ (base ì»¬ëŸ¬)
        setSvgTopBottom(base, null);

        // 2) ì¶”ì²œ API í˜¸ì¶œ (ì—†ìœ¼ë©´ fallback)
        // ------------- ì¶”ì²œ API í˜¸ì¶œ ë° ê²°ê³¼ ì²˜ë¦¬ (êµì²´) -------------
try {
    const resp = await fetch(`/api/color/recommend?color=${encodeURIComponent(base)}`);
    if (resp.ok) {
        const data = await resp.json();

        // ë‹¤ì–‘í•œ ì‘ë‹µ í˜•íƒœë¥¼ ì•ˆì „í•˜ê²Œ ìƒ‰ ë°°ì—´ë¡œ ì¶”ì¶œ
        let list = [];
        if (Array.isArray(data)) {
            list = data;
        } else if (data && Array.isArray(data.colors)) {
            // The Color API í˜•ì‹: { colors: [ { hex: { value: "#..." }, ... }, ... ] }
            list = data.colors.map(c => {
                if (c && c.hex && c.hex.value) return c.hex.value;
                // fallback: ìƒ‰ í‚¤/ì½”ë“œê°€ ì§ì ‘ ìˆì„ ìˆ˜ ìˆìŒ
                if (typeof c === 'string') return c;
                if (c && (c.code || c.key || c.name)) return c.code || c.key || c.name;
                return null;
            }).filter(Boolean);
        } else if (data && Array.isArray(data.results)) {
            // í˜¹ì‹œ ë‹¤ë¥¸ API í˜•ì‹ì¼ ê²½ìš°
            list = data.results.map(r => (r.color || r.hex || r.code || r)).filter(Boolean);
        } else {
            // ìœ ì—°í•œ ì¶”ì¶œ í•¨ìˆ˜ ì‚¬ìš© (ë„¤ì´í‹°ë¸Œ/ì»¤ìŠ¤í…€ í¬ë§· ëŒ€ì‘)
            list = extractColorsFromResponse(data);
        }

        // render
        renderRecommended(list);
        attachExplanationsToCards(list);

        // ì´ˆê¸° í•˜ì˜ì€ ì²«ë²ˆì§¸ ì¶”ì²œ(ìˆìœ¼ë©´)
        if (Array.isArray(list) && list.length > 0) {
            setSvgTopBottom(base, list[0]);
            // ì„ íƒ ê°•ì¡°: DOMì´ ë Œë”ëœ í›„ ì²˜ë¦¬
            setTimeout(()=> {
                const firstCard = document.querySelector('#result .color-card');
                if (firstCard) {
                    if(selectedCard) selectedCard.classList.remove('selected');
                    firstCard.classList.add('selected');
                    selectedCard = firstCard;
                }
            }, 30);
        }

    } else {
        // fallback
        const fallback = [base, 'navy', 'khaki', 'lightblue'].filter(Boolean);
        renderRecommended(fallback);
        attachExplanationsToCards(fallback);
        setSvgTopBottom(base, fallback[1] || fallback[0]);
    }
} catch (e) {
    // fallback on error
    const fallback = [base, 'navy', 'khaki', 'lightblue'].filter(Boolean);
    renderRecommended(fallback);
    attachExplanationsToCards(fallback);
    setSvgTopBottom(base, fallback[1] || fallback[0]);
}

    });

    /* -------------------- ì´ˆê¸° ìƒíƒœ (ë¹ˆ ê²°ê³¼) -------------------- */
    renderRecommended([]);

    /* -------------------- ë„ìš°ë¯¸: ì„œë²„ê°€ í‚¤ë¡œ ì£¼ì§€ ì•Šê³  ê°ì²´ë¡œ ì¤„ ê²½ìš° ëŒ€ì‘ (optional) -------------------- */
    /* ì˜ˆ: [{name:'ë¼ì„', code:'#C7E76F'}, 'navy', '#fff'] í˜•íƒœë¥¼ ì–´ëŠ ì •ë„ í—ˆìš© */
    function extractColorsFromResponse(arr) {
        if(!Array.isArray(arr)) return [];
        return arr.map(it => {
            if(typeof it === 'string') return it;
            if(it && typeof it === 'object') {
                // ìš°ì„  code, then key, then name
                if(it.code) return it.code;
                if(it.key) return it.key;
                if(it.name) return it.name;
            }
            return '';
        }).filter(Boolean);
    }

    /* -------------------- accessibility & final notes -------------------- */
    /* (í•„ìš” ì‹œ ì½˜ì†” ë¡œê·¸ë¡œ ë””ë²„ê¹…) */
    // console.log('color map loaded', COLOR_MAP);

    /* -------------------- ìƒÂ·í•˜ì˜ ì¡°í•© ì„¤ëª… ë§¤í•‘ -------------------- */
const COLOR_COMBINATIONS = {
    black: ["í™”ì´íŠ¸", "ê·¸ë ˆì´", "ë¼ì´íŠ¸ ë¸”ë£¨", "ë¼ì„"],
    white: ["ë¸”ë™", "ë„¤ì´ë¹„", "ë²„ê±´ë””", "ë² ì´ì§€"],
    navy:  ["í™”ì´íŠ¸", "ê·¸ë ˆì´", "ë¼ì´íŠ¸ ë¸”ë£¨", "ì¹´í‚¤"],
    gray:  ["ë¸”ë™", "í™”ì´íŠ¸", "ë¯¼íŠ¸", "ë¼ì´íŠ¸ ë¸”ë£¨"],
    beige: ["ë¸Œë¼ìš´", "í™”ì´íŠ¸", "ë¸”ë™", "ì˜¬ë¦¬ë¸Œ"]
};


/* ìƒ‰ ì˜ë¬¸ â†’ í•œê¸€ ë³€í™˜ */
const COLOR_NAME = {
    black:"ë¸”ë™", white:"í™”ì´íŠ¸", gray:"ê·¸ë ˆì´", navy:"ë„¤ì´ë¹„",
    lightblue:"ë¼ì´íŠ¸ ë¸”ë£¨", lime:"ë¼ì„", khaki:"ì¹´í‚¤", brown:"ë¸Œë¼ìš´",
    beige:"ë² ì´ì§€", mint:"ë¯¼íŠ¸", ë²„ê±´ë””:"ë²„ê±´ë””", ì˜¬ë¦¬ë¸Œ:"ì˜¬ë¦¬ë¸Œ"
};

/* -------------------- ì¡°í•© ë°•ìŠ¤ í‘œì‹œ í•¨ìˆ˜ -------------------- */
function showMatchInfo(baseColorKey) {
    const box = document.getElementById("matchInfoBox");
    const content = document.getElementById("matchInfoContent");

    const matches = COLOR_COMBINATIONS[baseColorKey];

    if(!matches) {
        box.style.display = "none";
        return;
    }

    // ìƒì˜ ì´ë¦„ ì¶œë ¥
    const topName = COLOR_NAME[baseColorKey] || baseColorKey;

    // í•˜ì˜ 4ê°œ ë³€í™˜
    const bottoms = matches.map(c => COLOR_NAME[c] || c);

    content.innerHTML = `
        <div style="margin-bottom:10px; font-weight:600;">
            ì„ íƒí•œ ìƒì˜ ìƒ‰: <span style="color:#111">${topName}</span>
        </div>
        <div>
            ì¶”ì²œë˜ëŠ” í•˜ì˜ ìƒ‰ 4ê°€ì§€:
            <ul style="margin:8px 0 0 18px;">
                ${bottoms.map(b => `<li>${b}</li>`).join("")}
            </ul>
        </div>
    `;

    box.style.display = "block";
}

    function updateComboBox(topKey, bottomKey) {
    const box = document.getElementById("combo-box");
    const text = document.getElementById("combo-text");

    if (!COLOR_COMBINATIONS[topKey]) return;

    const topName = COLOR_MAP[topKey].name;
    const bottomName = COLOR_MAP[bottomKey]?.name || bottomKey;

    const matches = COLOR_COMBINATIONS[topKey];

    text.innerHTML = `
        <b>${topName}</b> ìƒì˜ëŠ”
        <b>${matches.join(', ')}</b> ìƒ‰ í•˜ì˜ì™€ ì˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.<br><br>
        í˜„ì¬ ì¶”ì²œëœ í•˜ì˜ ìƒ‰ì€ <b>${bottomName}</b> ì…ë‹ˆë‹¤.
    `;

    box.style.display = "block";
}





</script>
</body>
</html>