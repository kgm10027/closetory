<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Closetory - ì£¼ê°„ ì½”ë”” ìº˜ë¦°ë”</title>
    <style>
        #weekStyleText {
            white-space: pre-line;
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fb;
            color: #111827;
        }

        /* ===== ìƒë‹¨ ê³ ì • í—¤ë” ===== */
        .clo-topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 72px;
            background: #ffffff;
            box-shadow: 0 6px 20px rgba(15,23,42,0.06);
            z-index: 50;
        }
        .clo-top-inner {
            max-width: 1180px;
            margin: 0 auto;
            height: 100%;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .clo-top-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .clo-hamburger {
            width: 36px;
            height: 36px;
            border-radius: 999px;
            border: none;
            background: #111827;
            color: #f9fafb;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .clo-logo-main a {
            text-decoration: none;
            color: inherit;
        }
        .clo-logo-main {
            font-size: 22px;
            font-weight: 900;
            letter-spacing: -0.4px;
            cursor: pointer;
        }
        .clo-logo-sub {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 2px;
        }
        .clo-top-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .clo-search-form {
            display: flex;
            align-items: center;
            background: #f3f4f6;
            border-radius: 999px;
            padding: 6px 12px;
            min-width: 260px;
        }
        .clo-search-icon {
            font-size: 14px;
            color: #6b7280;
            margin-right: 6px;
        }
        .clo-search-input {
            border: none;
            background: transparent;
            outline: none;
            font-size: 13px;
            width: 100%;
        }
        .clo-top-btn {
            height: 36px;
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background: #ffffff;
            padding: 0 14px;
            font-size: 12px;
            cursor: pointer;
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }
        .clo-top-btn.primary {
            background: #111827;
            color: #f9fafb;
            border-color: #111827;
            font-weight: 600;
        }
        .clo-top-btn:hover {
            background: #f3f4f6;
        }
        .clo-top-btn.primary:hover {
            background: #020617;
        }
        .clo-user-status {
            font-size: 12px;
            color: #6b7280;
            margin-right: 4px;
        }

        /* ===== ì‚¬ì´ë“œë°” ===== */
        .clo-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 230px;
            background: #111827;
            color: #e5e7eb;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            transform: translateX(-100%);
            transition: transform .25s	DECLARE;
            z-index: 60;
        }
        body.clo-sidebar-open .clo-sidebar {
            transform: translateX(0);
        }
        .clo-sidebar-header {
            font-size: 18px;
            font-weight: 800;
        }
        .clo-sidebar-sub {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 2px;
        }
        .clo-menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 14px;
        }
        .clo-menu-list li {
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background .2s, color .2s;
        }
        .clo-menu-list li:hover {
            background: #1f2937;
            color: #f9fafb;
        }
        .clo-menu-list li.clo-active {
            background: #fbbf24;
            color: #111827;
            font-weight: 700;
        }
        .clo-sidebar-footer {
            margin-top: auto;
            font-size: 11px;
            color: #6b7280;
        }
        .clo-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.35);
            opacity: 0;
            pointer-events: none;
            transition: opacity .2s ease-out;
            z-index: 55;
        }
        body.clo-sidebar-open .clo-backdrop {
            opacity: 1;
            pointer-events: auto;
        }

        /* ===== ë©”ì¸ ì»¨í…ì¸  ===== */
        .clo-main-outer {
            padding-top: 96px;
        }
        .clo-main-wrap {
            max-width: 1180px;
            margin: 0 auto;
            padding: 0 24px 40px;
        }

        /* íƒ€ì´í‹€ */
        .calendar-header h1 {
            margin: 0;
            font-size: 32px;
            font-weight: 900;
        }
        .calendar-header p {
            margin: 6px 0 0;
            font-size: 14px;
            color: #6b7280;
        }

        /* ì¹´í…Œê³ ë¦¬ íƒ­ */
        .category-tabs {
            margin-top: 16px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .category-tab {
            border-radius: 999px;
            border: 1px solid #e5e7eb;
            background: #f3f4f6;
            padding: 6px 14px;
            font-size: 13px;
            cursor: pointer;
            color: #4b5563;
        }
        .category-tab.active {
            background: #fff;
            color: #111827;
            border-color: #111827;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(15,23,42,0.06);
        }

        /* ===== ìë™ ë°°ì¹˜ ë²„íŠ¼ (í˜„ì¬ ë¯¸ì‚¬ìš© ìŠ¤íƒ€ì¼) ===== */
        .auto-fill-btn {
            width: 100%;
            max-width: 1180px;
            margin: 0 auto 20px;
            display: block;
            padding: 12px 18px;
            font-size: 14px;
            font-weight: 700;
            border-radius: 999px;
            background: #111827;
            color: #f9fafb;
            border: none;
            cursor: pointer;
            text-align: center;
        }
        .auto-fill-btn:hover {
            background: #020617;
        }

        /* ===== ì£¼ê°„ ìŠ¬ë¼ì´ë” ===== */
        .calendar-slider {
            position: relative;
            margin-top: 12px;
        }
        .week-viewport {
            overflow: hidden;
        }
        .week-track {
            display: flex;
            gap: 18px;
            transition: transform .35s ease;
        }

        /* ìš”ì¼ ì¹´ë“œ */
        .day-card {
            flex: 0 0 calc((100% - 2 * 18px) / 3);
            background: #ffffff;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 10px 24px rgba(15,23,42,0.06);
            display: flex;
            flex-direction: column;
            gap: 10px;
            cursor: pointer;
            position: relative;
        }

        /* ì˜¤ëŠ˜ ê°•ì¡° (í˜„ì¬ëŠ” sortDaysByTodayë¡œ ì˜¤ëŠ˜ì´ ì²« ì¹´ë“œë¡œ ì˜¤ê²Œ ì²˜ë¦¬) */
        .day-card.today {
            border: 2px solid #facc15;
            box-shadow: 0 0 0 3px rgba(250,204,21,0.3);
        }
        .day-today-badge {
            position: absolute;
            top: -10px;
            left: -10px;
            background: #facc15;
            color: #111;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 999px;
        }

        .day-title {
            font-size: 15px;
            font-weight: 700;
        }

        /* ì „ì‹  ì´ë¯¸ì§€ ëŒ€ì‘ í™•ëŒ€ ë°•ìŠ¤ */
        .day-img {
            width: 100%;
            height: 240px;
            background: #eef0f4;
            border-radius: 14px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
        }

        .day-desc {
            font-size: 13px;
            color: #6b7280;
        }

        .heart-btn {
            font-size: 16px;
            cursor: pointer;
            color: #9ca3af;
            align-self: flex-end;
        }
        .heart-btn.active {
            color: #ef4444;
        }

        /* ìŠ¬ë¼ì´ë“œ ë²„íŠ¼ */
        .week-slide-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            border-radius: 999px;
            border: none;
            background: rgba(15,23,42,0.75);
            color: #f9fafb;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            z-index: 10;
            backdrop-filter: blur(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .week-slide-btn.prev {
            left: -16px;
        }

        .week-slide-btn.next {
            right: -16px;
        }

        .week-slide-btn:hover {
            background: rgba(15,23,42,0.90);
        }
        .week-slide-btn:disabled {
            opacity: 0.3;
            cursor: default;
        }

        /* ===== ìƒì„¸ ëª¨ë‹¬ ===== */
        .cal-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        .cal-modal-backdrop.show {
            display: flex;
        }

        .cal-modal {
            background: #fff;
            width: 520px;
            max-width: 92vw;
            max-height: 90vh;
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px rgba(0,0,0,0.22);
        }

        .cal-modal-header {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cal-modal-header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 800;
        }
        .cal-modal-close {
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: #9ca3af;
        }

        .cal-modal-image {
            width: 100%;
            height: 340px;
            background:#eef0f4;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cal-modal-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .cal-modal-body {
            padding: 16px 20px 22px;
            font-size: 14px;
            color: #4b5563;
            overflow-y: auto;
        }
        .cal-modal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }
        .cal-tag {
            background:#e8efff;
            padding:4px 10px;
            font-size:11px;
            border-radius:999px;
            color:#374151;
        }
        .cal-modal-like-btn {
            width:100%;
            margin-top:18px;
            padding:10px;
            border:none;
            border-radius:999px;
            background:#111827;
            color:white;
            cursor:pointer;
            font-weight:600;
        }
        .cal-modal-like-btn.fav {
            background:#b91c1c;
        }

        /* ë¶„ì„ ë°•ìŠ¤ */
        .week-style-analysis {
            margin-top: 34px;
            background:#ffffff;
            box-shadow:0 10px 24px rgba(15,23,42,0.06);
            border-radius:16px;
            padding:22px 24px;
        }
        .week-style-analysis h2 {
            margin:0;
            font-size:20px;
            font-weight:800;
        }
        .week-style-analysis p {
            margin-top:8px;
            font-size:14px;
            color:#6b7280;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 960px) {
            .day-card { flex: 0 0 80%; }
            .week-slide-btn.prev { left: 4px; }
            .week-slide-btn.next { right: 4px; }
        }
    </style>
</head>
<body>

<!-- ì‚¬ì´ë“œë°” -->
<nav class="clo-sidebar">
    <div>
        <div class="clo-sidebar-header">ë©”ë‰´</div>
        <div class="clo-sidebar-sub">Closetory ì˜·ì¥ ë©”ë‰´</div>
    </div>
    <ul class="clo-menu-list">
        <li onclick="location.href='closet.html'">ë‚˜ë§Œì˜ ì˜·ì¥</li>
        <li onclick="location.href='color.html'">ì½”ë”” ìƒ‰ê° ì¶”ì²œ</li>
        <li onclick="location.href='situation.html'">ìƒí™©ë³„ ì½”ë”” ì¶”ì²œ</li>
        <li class="clo-active" onclick="location.href='calendar.html'">ì£¼ê°„ ì½”ë”” ìº˜ë¦°ë”</li>
        <li onclick="location.href='ranking.html'">ì¸ê¸° ì½”ë”” ë­í‚¹</li>
    </ul>
    <div class="clo-sidebar-footer">
        Closetory Â· ì˜·ì¥ì—ì„œ êº¼ë‚´ëŠ” ì‘ì€ í–‰ë³µ
    </div>
</nav>
<div class="clo-backdrop"></div>

<!-- ìƒë‹¨ë°” -->
<header class="clo-topbar">
    <div class="clo-top-inner">
        <div class="clo-top-left">
            <button class="clo-hamburger" id="cloMenuBtn">â˜°</button>
            <div>
                <div class="clo-logo-main">
                    <a href="index.html">Closetory</a>
                </div>
                <div class="clo-logo-sub">ì˜·ì¥ì—ì„œ êº¼ë‚´ëŠ” ì‘ì€ í–‰ë³µ</div>
            </div>
        </div>

        <div class="clo-top-right">
            <form class="clo-search-form" onsubmit="return false;">
                <span class="clo-search-icon">ğŸ”</span>
                <input class="clo-search-input" type="text" placeholder="ì½”ë””, ì•„ì´í…œ ê²€ìƒ‰">
            </form>

            <span class="clo-user-status" id="userStatus"></span>
            <button class="clo-top-btn" id="loginBtn">ë¡œê·¸ì¸</button>
            <button class="clo-top-btn" id="signupBtn">íšŒì›ê°€ì…</button>
            <button class="clo-top-btn primary" id="mypageBtn" style="display:none;">ë§ˆì´í˜ì´ì§€</button>
            <button class="clo-top-btn" id="logoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>
</header>

<!-- ë©”ì¸ -->
<div class="clo-main-outer">
    <main class="clo-main-wrap">

        <!-- ì œëª© -->
        <section class="calendar-header">
            <h1>ì£¼ê°„ ì½”ë”” ìº˜ë¦°ë”</h1>
            <p>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì„œ ì˜¤ëŠ˜ì„ ê¸°ì¤€ìœ¼ë¡œ 1ì£¼ì¼ ì½”ë””ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>

            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
            <div class="category-tabs" id="categoryTabs">
                <button class="category-tab active" data-category="daily">ë°ì¼ë¦¬</button>
                <button class="category-tab" data-category="date">ë°ì´íŠ¸</button>
                <button class="category-tab" data-category="campus">ìº í¼ìŠ¤</button>
                <button class="category-tab" data-category="travel">ì—¬í–‰</button>
            </div>
        </section>

        <!-- ì£¼ê°„ ìŠ¬ë¼ì´ë” -->
        <section class="calendar-slider">
            <button class="week-slide-btn prev" id="weekPrevBtn">â€¹</button>

            <div class="week-viewport">
                <div class="week-track" id="weekTrack">

                    <!-- ì›”ìš”ì¼ -->
                    <article class="day-card" data-day-index="0">
                        <div class="day-title">ì›”ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ì›”ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- í™”ìš”ì¼ -->
                    <article class="day-card" data-day-index="1">
                        <div class="day-title">í™”ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">í™”ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ìˆ˜ìš”ì¼ -->
                    <article class="day-card" data-day-index="2">
                        <div class="day-title">ìˆ˜ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ìˆ˜ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ëª©ìš”ì¼ -->
                    <article class="day-card" data-day-index="3">
                        <div class="day-title">ëª©ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ëª©ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ê¸ˆìš”ì¼ -->
                    <article class="day-card" data-day-index="4">
                        <div class="day-title">ê¸ˆìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ê¸ˆìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- í† ìš”ì¼ -->
                    <article class="day-card" data-day-index="5">
                        <div class="day-title">í† ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">í† ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                    <!-- ì¼ìš”ì¼ -->
                    <article class="day-card" data-day-index="6">
                        <div class="day-title">ì¼ìš”ì¼</div>
                        <div class="day-img"></div>
                        <div class="day-desc">ì¼ìš”ì¼ ì½”ë””ì…ë‹ˆë‹¤.</div>
                    </article>

                </div>
            </div>

            <button class="week-slide-btn next" id="weekNextBtn">â€º</button>
        </section>

        <!-- ì´ë²ˆ ì£¼ ìŠ¤íƒ€ì¼ ë¶„ì„ -->
        <section class="week-style-analysis">
            <h2>ì´ë²ˆ ì£¼ ìŠ¤íƒ€ì¼ ë¶„ì„</h2>
            <p id="weekStyleText">
                ì´ë²ˆ ì£¼ ì½”ë”” ë¶„ì„ ì¤‘...
            </p>
        </section>
    </main>
</div>

<!-- ìƒì„¸ ëª¨ë‹¬ -->
<div class="cal-modal-backdrop" id="calModalBackdrop">
    <div class="cal-modal" id="calModal">
        <div class="cal-modal-header">
            <h2 id="calModalTitle">ì½”ë”” ì œëª©</h2>
            <button class="cal-modal-close" id="calModalClose">Ã—</button>
        </div>

        <div class="cal-modal-image">
            <img id="calModalImg" src="" alt="">
        </div>

        <div class="cal-modal-body">
            <div class="cal-modal-tags" id="calModalTags"></div>
            <p id="calModalDesc"></p>

            <button id="calModalLikeBtn" class="cal-modal-like-btn">â™¡ ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ê¸°</button>
        </div>
    </div>
</div>

<script>
    /* ===== ì‚¬ì´ë“œë°” í† ê¸€ + ê²€ì€ ë°°ê²½ í´ë¦­ ì‹œ ë‹«í˜ ===== */
    const bodyEl  = document.body;
    const menuBtn = document.getElementById('cloMenuBtn');
    const backdrop = document.querySelector('.clo-backdrop');

    function toggleSidebar() {
        bodyEl.classList.toggle('clo-sidebar-open');
    }
    if (menuBtn)  menuBtn.addEventListener('click', toggleSidebar);
    if (backdrop) backdrop.addEventListener('click', () => {
        bodyEl.classList.remove('clo-sidebar-open');
    });

    /* ===== ë¡œê·¸ì¸ ìƒíƒœ ì²˜ë¦¬ ===== */
    const loginBtn   = document.getElementById('loginBtn');
    const signupBtn  = document.getElementById('signupBtn');
    const logoutBtn  = document.getElementById('logoutBtn');
    const mypageBtn  = document.getElementById('mypageBtn');
    const userStatus = document.getElementById('userStatus');

    function checkAuthState() {
        const raw = localStorage.getItem('closetoryUser');
        if (raw) {
            const user = JSON.parse(raw);
            userStatus.textContent = (user.name || 'ì‚¬ìš©ì') + ' ë‹˜ ë¡œê·¸ì¸ ì¤‘';
            loginBtn.style.display   = 'none';
            signupBtn.style.display  = 'none';
            mypageBtn.style.display  = 'inline-flex';
            logoutBtn.style.display  = 'inline-flex';
        } else {
            userStatus.textContent = '';
            loginBtn.style.display   = 'inline-flex';
            signupBtn.style.display  = 'inline-flex';
            mypageBtn.style.display  = 'none';
            logoutBtn.style.display  = 'none';
        }
    }
    checkAuthState();

    if (loginBtn)  loginBtn.addEventListener('click', () => location.href = 'login.html');
    if (signupBtn) signupBtn.addEventListener('click', () => location.href = 'signup.html');
    if (mypageBtn) mypageBtn.addEventListener('click', () => location.href = 'mypage.html');
    if (logoutBtn) logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('closetoryUser');
        checkAuthState();
        alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
        location.href = 'index.html';
    });

    /* ==========================================================
       1) ì°œ ë°ì´í„° (closet.html / ranking.html ì™„ì „ ë™ì¼ êµ¬ì¡°)
    ========================================================== */
    const FAVORITES_KEY = 'closetoryFavorites';

    function loadFavorites() {
        try {
            return JSON.parse(localStorage.getItem(FAVORITES_KEY) || '[]');
        } catch (_) {
            return [];
        }
    }

    function saveFavorites(list) {
        localStorage.setItem(FAVORITES_KEY, JSON.stringify(list));
    }

    function isFavorite(id) {
        return loadFavorites().some(it => String(it.id) === String(id));
    }

    /* ==========================================================
       2) ìƒì„¸ëª¨ë‹¬ ì—°ë™
    ========================================================== */
    const calModalBackdrop = document.getElementById('calModalBackdrop');
    const calModal         = document.getElementById('calModal');
    const calModalClose    = document.getElementById('calModalClose');
    const calModalImg      = document.getElementById('calModalImg');
    const calModalTitle    = document.getElementById('calModalTitle');
    const calModalTags     = document.getElementById('calModalTags');
    const calModalDesc     = document.getElementById('calModalDesc');
    const calModalLikeBtn  = document.getElementById('calModalLikeBtn');

    let currentModalItem = null;

    function openCalModal(item) {
        currentModalItem = item;

        calModalTitle.textContent = item.title || "ì½”ë”” ì •ë³´";
        calModalImg.src = item.imageUrl || "";
        calModalImg.alt = item.title || "";

        calModalTags.innerHTML = "";
        (item.tags || []).forEach(t => {
            const span = document.createElement('span');
            span.className = "cal-tag";
            span.textContent = t;
            calModalTags.appendChild(span);
        });

        calModalDesc.textContent = item.desc || "ì½”ë”” ì„¤ëª…ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.";

        // ì°œ ë²„íŠ¼ ìƒíƒœ
        if (isFavorite(item.id)) {
            calModalLikeBtn.textContent = "â¤ ì°œ í•´ì œ";
        } else {
            calModalLikeBtn.textContent = "â™¡ ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ê¸°";
        }

        calModalBackdrop.classList.add("show");
    }

    calModalClose.addEventListener('click', () => {
        calModalBackdrop.classList.remove('show');
    });
    calModalBackdrop.addEventListener('click', e => {
        if (e.target === calModalBackdrop) {
            calModalBackdrop.classList.remove('show');
        }
    });

    /* ===== ìƒì„¸ ëª¨ë‹¬ ì°œê¸°ëŠ¥ ===== */
    calModalLikeBtn.addEventListener('click', () => {
        if (!currentModalItem) return;

        const favs = loadFavorites();
        const exist = favs.find(f => f.id === currentModalItem.id);

        if (exist) {
            // í•´ì œ
            const newList = favs.filter(f => f.id !== currentModalItem.id);
            saveFavorites(newList);
            calModalLikeBtn.textContent = "â™¡ ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ê¸°";
            alert("ì°œ í•´ì œí–ˆìŠµë‹ˆë‹¤.");
        } else {
            favs.push({
                ...currentModalItem,
                isFavorite: true,
                createdAt: Date.now()
            });
            saveFavorites(favs);
            calModalLikeBtn.textContent = "â¤ ì°œ í•´ì œ";
            alert("ë‚˜ë§Œì˜ ì˜·ì¥ì— ë‹´ì•˜ìŠµë‹ˆë‹¤!");
        }
    });

    /* ==========================================================
       3) ì£¼ê°„ ì½”ë”” ìë™ ì¶”ì²œ (ìƒí™©ë³„ ì½”ë”” ì—°ë™)
       - situation.html ì¹´ë“œë“¤ì„ ë°ì´í„° í’€ë¡œ ì‚¬ìš©
       - (ì¹´í…Œê³ ë¦¬ + ë‚ ì§œ) ë‹¨ìœ„ë¡œ í•œ ë²ˆ ë°°ì •ëœ ì½”ë””ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
       - ê°™ì€ ì£¼(ì›”~ì¼) ì•ˆì—ì„œëŠ” ê°€ëŠ¥í•œ í•œ ê²¹ì¹˜ì§€ ì•Šê²Œ
    ========================================================== */

    const SITUATION_STORAGE_KEY = "closetorySituationItems";
    const CALENDAR_ASSIGN_KEY   = "closetoryCalendarAssignments";

    let SITUATION_ITEMS = [];

    // ìƒí™©ë³„ ì½”ë”” í’€ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadSituationItems() {
        if (SITUATION_ITEMS.length) return SITUATION_ITEMS;

        try {
            const raw = localStorage.getItem(SITUATION_STORAGE_KEY);
            const parsed = raw ? JSON.parse(raw) : [];
            if (Array.isArray(parsed)) {
                SITUATION_ITEMS = parsed;
            } else {
                SITUATION_ITEMS = [];
            }
        } catch (e) {
            console.error("ìƒí™©ë³„ ì½”ë”” ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", e);
            SITUATION_ITEMS = [];
        }
        return SITUATION_ITEMS;
    }

    // ë‚ ì§œë³„ ë°°ì • ì •ë³´ ê´€ë¦¬
    function loadCalendarAssignments() {
        try {
            const raw = localStorage.getItem(CALENDAR_ASSIGN_KEY);
            const obj = raw ? JSON.parse(raw) : {};
            return obj && typeof obj === "object" ? obj : {};
        } catch (e) {
            return {};
        }
    }

    function saveCalendarAssignments(map) {
        localStorage.setItem(CALENDAR_ASSIGN_KEY, JSON.stringify(map));
    }

    // JS getDay(): 0=ì¼ ~ 6=í†  â†’ ì›”=0 ~ ì¼=6
    function getMondayBasedIndex(jsDay) {
        return (jsDay + 6) % 7;
    }

    // ì›”~ì¼ ì¸ë±ìŠ¤(0~6)ë¥¼ ì‹¤ì œ ë‚ ì§œ(YYYY-MM-DD) ë¬¸ìì—´ë¡œ
    function getDateStringForDayIndex(dayIdx) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const jsDay = today.getDay();                 // 0=ì¼ ~ 6=í† 
        const mondayBasedToday = getMondayBasedIndex(jsDay);

        const diff = dayIdx - mondayBasedToday;
        const target = new Date(today);
        target.setDate(today.getDate() + diff);

        const y = target.getFullYear();
        const m = String(target.getMonth() + 1).padStart(2, "0");
        const d = String(target.getDate()).padStart(2, "0");
        return `${y}-${m}-${d}`;
    }

    // ìº˜ë¦°ë” ì¹´í…Œê³ ë¦¬ â†’ situation data-type ë§¤í•‘
    function getTypesForCategory(categoryKey) {
        switch (categoryKey) {
            case "date":
                return ["date"];               // ë°ì´íŠ¸ë£©ë§Œ
            case "campus":
                return ["office", "gym"];      // ìº í¼ìŠ¤ ëŠë‚Œ = ì¶œê·¼/í—¬ìŠ¤
            case "travel":
                return ["travel", "camping"];  // ì—¬í–‰ / ìº í•‘
            case "daily":
            default:
                return null; // ì „ì²´ ì‚¬ìš©
        }
    }

    // ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” ìƒí™© ì½”ë”” í’€
    function getPoolForCategory(categoryKey) {
        const all = loadSituationItems();
        const types = getTypesForCategory(categoryKey);
        if (!types) return all;
        return all.filter(it => types.includes(it.type));
    }

    const weekdayLabels = ['ì›”ìš”ì¼','í™”ìš”ì¼','ìˆ˜ìš”ì¼','ëª©ìš”ì¼','ê¸ˆìš”ì¼','í† ìš”ì¼','ì¼ìš”ì¼'];
    let activeCategory = 'daily';
    const categoryTabs = document.querySelectorAll('.category-tab');

    function applyCategory(categoryKey) {
        activeCategory = categoryKey;

        const activeTabEl = document.querySelector(`.category-tab[data-category="${categoryKey}"]`);
        const categoryName = activeTabEl ? activeTabEl.textContent.trim() : '';

        const pool = getPoolForCategory(categoryKey);
        const assignments = loadCalendarAssignments();

        // ê°™ì€ (ì¹´í…Œê³ ë¦¬ + í•œ ì£¼) ì•ˆì—ì„œ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ê´€ë¦¬
        const usedIdsThisWeek = new Set();

        document.querySelectorAll('.day-card').forEach(card => {
            const dayIdx = Number(card.dataset.dayIndex);
            const imgEl = card.querySelector('.day-img');
            const descEl = card.querySelector('.day-desc');

            const weekdayName = weekdayLabels[dayIdx];
            const dateStr = getDateStringForDayIndex(dayIdx);
            const assignKey = `${categoryKey}:${dateStr}`;

            // 1) ì´ë¯¸ ì €ì¥ëœ ì½”ë”” ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ê¸°ì¡´ ì¶”ì²œ ìœ ì§€)
            let assignedId = assignments[assignKey];
            let item = assignedId && pool.find(it => it.id === assignedId);

            // 2) ì—†ê±°ë‚˜, í’€ì—ì„œ ì‚¬ë¼ì¡Œìœ¼ë©´ ìƒˆë¡œ ì¶”ì²œ
            if (!item) {
                let candidates = pool.filter(it => !usedIdsThisWeek.has(it.id));

                // í’€ë³´ë‹¤ ìš”ì¼ì´ ë§ì„ ê²½ìš°: ì¤‘ë³µ í—ˆìš© ìœ„í•´ ì´ˆê¸°í™”
                if (!candidates.length) {
                    candidates = pool.slice();
                    usedIdsThisWeek.clear();
                }

                if (candidates.length) {
                    item = candidates[Math.floor(Math.random() * candidates.length)];
                    assignments[assignKey] = item.id;
                } else {
                    item = null;
                }
            }

            if (item) {
                usedIdsThisWeek.add(item.id);

                // ì¹´ë“œì— í˜„ì¬ ë°°ì • ì •ë³´ ê¸°ë¡
                card.dataset.itemId = item.id;
                card.dataset.date = dateStr;
                card.dataset.category = categoryKey;

                imgEl.style.backgroundImage = `url('${item.img}')`;
                descEl.textContent = `${item.title || categoryName} Â· ${weekdayName}`;
            } else {
                // ìƒí™© ì½”ë”” ë°ì´í„°ê°€ ì—†ì„ ë•Œ ê¸°ë³¸ í…ìŠ¤íŠ¸
                card.dataset.itemId = "";
                card.dataset.date = dateStr;
                card.dataset.category = categoryKey;

                imgEl.style.backgroundImage = 'none';
                descEl.textContent = `${categoryName} Â· ${weekdayName} ì½”ë””`;
            }
        });

        saveCalendarAssignments(assignments);
    }

    // ì¹´í…Œê³ ë¦¬ íƒ­ í´ë¦­ ì‹œ ì¬ë°°ì • + ìŠ¤íƒ€ì¼ ë¶„ì„
    categoryTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const category = tab.dataset.category;
            categoryTabs.forEach(t => t.classList.toggle('active', t === tab));
            resetToTodayWindow();
            applyCategory(category);
            analyzeWeekStyle();
        });
    });

    /* ==========================================================
       4) ìŠ¬ë¼ì´ë” â€” 3ê°œì”© ë³´ì´ê²Œ / ì˜¤ëŠ˜ì´ ë§¨ ì•
    ========================================================== */

    const weekTrack = document.getElementById('weekTrack');
    const weekPrevBtn = document.getElementById('weekPrevBtn');
    const weekNextBtn = document.getElementById('weekNextBtn');

    let dayCards = Array.from(weekTrack.children);
    const VISIBLE_COUNT = 3;
    const GAP = 18;
    let slideIndex = 0;
    let cardStep = 0;
    let maxIndex = Math.max(0, dayCards.length - VISIBLE_COUNT);

    // ì˜¤ëŠ˜ì´ ì²« ì¹´ë“œê°€ ë˜ë„ë¡ ì£¼ê°„ ë°°ì—´ ì¬ë°°ì¹˜
    function sortDaysByToday() {
        const today = new Date();
        const jsDay = today.getDay();       // 0~6
        const mondayBasedToday = getMondayBasedIndex(jsDay);

        dayCards = Array.from(weekTrack.children);

        const sorted = dayCards.slice().sort((a, b) => {
            const aIdx = Number(a.dataset.dayIndex);
            const bIdx = Number(b.dataset.dayIndex);
            const aOff = (aIdx - mondayBasedToday + 7) % 7;
            const bOff = (bIdx - mondayBasedToday + 7) % 7;
            return aOff - bOff;
        });

        sorted.forEach(c => weekTrack.appendChild(c));
        dayCards = sorted;
        slideIndex = 0;
        updateMetrics();
    }

    function recalcMaxIndex() {
        maxIndex = Math.max(0, dayCards.length - VISIBLE_COUNT);
    }

    function updateNavButtons() {
        recalcMaxIndex();
        weekPrevBtn.disabled = (slideIndex <= 0);
        weekNextBtn.disabled = (slideIndex >= maxIndex);
    }

    function updateMetrics() {
        if (!dayCards.length) return;
        const first = dayCards[0];
        const rect = first.getBoundingClientRect();
        cardStep = rect.width + GAP;

        weekTrack.style.transition = 'none';
        weekTrack.style.transform = `translateX(-${slideIndex * cardStep}px)`;

        requestAnimationFrame(() => {
            weekTrack.style.transition = 'transform .35s ease';
        });

        updateNavButtons();
    }

    function goToSlide(idx) {
        recalcMaxIndex();
        slideIndex = Math.min(Math.max(idx, 0), maxIndex);
        weekTrack.style.transform = `translateX(-${slideIndex * cardStep}px)`;
        updateNavButtons();
    }

    function resetToTodayWindow() {
        goToSlide(0);
    }

    weekPrevBtn.addEventListener('click', () => goToSlide(slideIndex - 1));
    weekNextBtn.addEventListener('click', () => goToSlide(slideIndex + 1));

    /* ==========================================================
       5) â€œí•˜ë£¨ ì¹´ë“œ í´ë¦­ â†’ ìƒì„¸ ëª¨ë‹¬ ë„ìš°ê¸°â€
       â˜… ì—¬ê¸°ì—ì„œ style / recommendê¹Œì§€ í•¨ê»˜ ë„˜ê²¨ì¤Œ
    ========================================================== */

    document.querySelectorAll('.day-card').forEach(card => {
        card.addEventListener('click', () => {
            const day = Number(card.dataset.dayIndex);
            const weekday = weekdayLabels[day];
            const categoryTitle = document.querySelector('.category-tab.active').textContent.trim();

            const itemId  = card.dataset.itemId;
            const dateStr = card.dataset.date;

            const pool = getPoolForCategory(activeCategory);
            const baseItem = itemId ? pool.find(it => it.id === itemId) : null;

            // â˜… ìŠ¤íƒ€ì¼/ì¶”ì²œë„ í•¨ê»˜ ë‹´ë„ë¡ ìˆ˜ì •
            const item = baseItem ? {
                id: baseItem.id,
                title: baseItem.title || `${weekday} (${categoryTitle}) ì½”ë””`,
                desc:  baseItem.desc  || `${categoryTitle} Â· ${weekday} ì½”ë””ì…ë‹ˆë‹¤.`,
                tags:  (baseItem.tags && baseItem.tags.length)
                    ? baseItem.tags
                    : [categoryTitle, weekday],
                imageUrl: baseItem.img,
                style: baseItem.style || "",
                recommend: baseItem.recommend || ""
            } : {
                id: `${activeCategory}-${day}`,
                title: `${weekday} (${categoryTitle}) ì½”ë””`,
                desc: `${categoryTitle} Â· ${weekday} ì½”ë””ì…ë‹ˆë‹¤.`,
                tags: [categoryTitle, weekday],
                imageUrl: "",
                style: "",
                recommend: ""
            };

            item.date = dateStr;

            openCalModal(item);
        });
    });

    /* ==========================================================
       6) ì´ë²ˆ ì£¼ ìŠ¤íƒ€ì¼ ë¶„ì„ ìë™ ìƒì„±
    ========================================================== */
    function analyzeWeekStyle() {
        let result = "";

        if (activeCategory === "daily") {
            result =
                "ì´ë²ˆ ì£¼ ë°ì¼ë¦¬ ì½”ë””ëŠ” ì „ì²´ì ìœ¼ë¡œ ì°¨ë¶„í•˜ê³  ì•ˆì •ì ì¸ ë¬´ë“œê°€ ë‹ë³´ì—¬ìš”.\n" +
                "ê¸°ë³¸ ì•„ì´í…œì„ í™œìš©í•´ ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ì†Œí™”í•  ìˆ˜ ìˆëŠ” ì¡°í•©ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n" +
                "ê³¼í•œ í¬ì¸íŠ¸ ì—†ì´ë„ ê¹”ë”í•˜ê²Œ ë–¨ì–´ì§€ëŠ” ì‹¤ë£¨ì—£ì´ ì¼ìƒ ì† í™œìš©ë„ë¥¼ ë†’ì—¬ì¤˜ìš”.\n" +
                "í¸ì•ˆí•¨ê³¼ ì‹¤ìš©ì„±ì„ ëª¨ë‘ ì±™ê¸´ ë°ì¼ë¦¬ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.";
        }

        else if (activeCategory === "date") {
            result =
                "ì´ë²ˆ ì£¼ ë°ì´íŠ¸ ì½”ë””ëŠ” ì „ì²´ì ìœ¼ë¡œ ë¶€ë“œëŸ½ê³  ì„¸ë ¨ëœ ë¶„ìœ„ê¸°ê°€ ê°•ì¡°ë¼ìš”.\n" +
                "í†¤ì˜¨í†¤ ë˜ëŠ” ì€ì€í•œ í¬ì¸íŠ¸ ì•„ì´í…œìœ¼ë¡œ ê³¼í•˜ì§€ ì•Šì€ ë§¤ë ¥ì„ ì‚´ë ¸ìŠµë‹ˆë‹¤.\n" +
                "ê¹”ë”í•œ ì‹¤ë£¨ì—£ê³¼ ì •ëˆëœ ì»¬ëŸ¬ê°ì´ ì¢‹ì€ ì¸ìƒì„ ì£¼ëŠ” ë° ë„ì›€ì„ ì¤˜ìš”.\n" +
                "ìì—°ìŠ¤ëŸ¬ìš°ë©´ì„œë„ ì‹ ê²½ ì“´ ë“¯í•œ ë°ì´íŠ¸ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.";
        }

        else if (activeCategory === "campus") {
            result =
                "ì´ë²ˆ ì£¼ ìº í¼ìŠ¤ ì½”ë””ëŠ” í¸ì•ˆí•¨ê³¼ í™œë™ì„±ì„ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆì–´ìš”.\n" +
                "ë§¨íˆ¬ë§¨, ë°ë‹˜ ë“± ìºì£¼ì–¼ ì•„ì´í…œì„ ìì—°ìŠ¤ëŸ½ê²Œ ë§¤ì¹˜í•´ ê°€ë²¼ìš´ ë¬´ë“œë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.\n" +
                "ê³¼í•œ ë””í…Œì¼ ì—†ì´ë„ ì‹¤ìš©ì ì´ë©° ì˜¤ë˜ ì…ì–´ë„ ë¶€ë‹´ ì—†ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”.\n" +
                "í™œë°œí•œ ìº í¼ìŠ¤ ë¼ì´í”„ì— ì˜ ì–´ìš¸ë¦¬ëŠ” í¸ì•ˆí•œ ì¡°í•©ì…ë‹ˆë‹¤.";
        }

        else if (activeCategory === "travel") {
            result =
                "ì´ë²ˆ ì£¼ ì—¬í–‰ ì½”ë””ëŠ” ì›€ì§ì„ì´ í¸í•œ ì‹¤ìš©ì ì¸ ìŠ¤íƒ€ì¼ì„ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆì–´ìš”.\n" +
                "ê°€ë²¼ìš´ ì•„ìš°í„°ì™€ ê¸°ë³¸ ì•„ì´í…œì„ í™œìš©í•´ ë‹¤ì–‘í•œ ìƒí™©ì—ì„œë„ ìì—°ìŠ¤ëŸ½ê²Œ ì–´ìš¸ë¦½ë‹ˆë‹¤.\n" +
                "í¸ì•ˆí•˜ë©´ì„œë„ ì‚¬ì§„ì— ì˜ ë‹´ê¸°ëŠ” ì»¬ëŸ¬ ì¡°í•©ì´ ë‹ë³´ì—¬ìš”.\n" +
                "í™œë™ì„±ê³¼ ìŠ¤íƒ€ì¼ì„ ëª¨ë‘ ì±™ê¸´ ì—¬í–‰ìš© ì½”ë””ì…ë‹ˆë‹¤.";
        }

        document.getElementById("weekStyleText").textContent = result;
    }

    /* ==========================================================
       ì´ˆê¸° ì‹¤í–‰
    ========================================================== */
    window.addEventListener('load', () => {
        sortDaysByToday();
        applyCategory(activeCategory);
        analyzeWeekStyle();
        updateMetrics();
    });
    window.addEventListener('resize', updateMetrics);
</script>
</body>
</html>